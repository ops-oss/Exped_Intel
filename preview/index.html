<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Scout Live Preview</title>
<style>
  :root{ --bg:#efefec; --ink:#1f1f1f; --paper:#fff; --accent:#fe5733; --div:rgba(0,0,0,.12); --div-soft:rgba(0,0,0,.08); }
  *{box-sizing:border-box} html,body{height:100%}
  body{ margin:0; background:var(--bg); color:var(--ink);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
.shell {
  display: grid;
  grid-template-columns: 35% 65%;
  gap: 24px;

  /* ↓ Narrow the overall canvas + add more side padding */
  max-width: 1120px;          /* was 1200px */
  margin: 0 auto;
  padding: 16px 24px;         /* was 16px (all sides) */
}

/* iPad / small laptop tighten-up */
@media (max-width: 1200px) and (min-width: 901px){
  .shell {
    max-width: 1040px;   /* pull everything in a bit */
    padding: 12px 18px;  /* slightly smaller outer padding */
    gap: 16px;           /* panels closer together */
  }

  .panel {
    padding: 12px;       /* slimmer cards so the right edge doesn't clip */
  }
}

@media (max-width: 900px) {
  .shell {
    grid-template-columns: 1fr;
  }
}
  
  /* Left panel */
  .panel{ background:var(--paper); border:1px solid var(--div); border-radius:12px; padding:16px; }
  .form-panel > h2{
    font-weight:900; font-size:clamp(48px,7vw,72px); line-height:1.02; letter-spacing:-0.025em; margin:0 0 8px;
  }
  .muted{opacity:.7; font-size:14px; line-height:1.5}

  .hero-intro{
  font-weight:700;
  font-size:1.5em;
  line-height:1.2;
  text-wrap: balance; /* optional, harmless if unsupported */
}

  /* Form grid */
  .grp{margin-top:12px; display:grid; grid-template-columns:1fr 1fr; gap:8px 12px; align-items:end}
  .row-1{grid-column:1 / -1}
  .grp label{font-size:12px; letter-spacing:.08em; text-transform:uppercase; opacity:.7}
  .grp input, .grp select, .grp textarea{
    width:100%; padding:12px 14px; border:1px solid var(--div); border-radius:12px; background:#fff; font:inherit;
    transition:border-color .15s ease, box-shadow .15s ease, background .15s ease;
  }
  .grp textarea{ min-height:120px; resize:vertical; line-height:1.5; }
  .grp input:focus, .grp select:focus, .grp textarea:focus{
    outline:0; border-color:rgba(0,0,0,.28); box-shadow:0 0 0 3px rgba(0,0,0,.06);
  }
  #scoutForm select{
    background-image:linear-gradient(to bottom,transparent,transparent),
      url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%23111' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><polyline points='6 9 12 15 18 9'/></svg>");
    background-repeat:no-repeat; background-position:right 12px center; background-size:18px; padding-right:38px;
  }

  /* Buttons */
  .btn{
    appearance:none !important; background:#111 !important; color:#fff !important; border:none !important;
    border-radius:8px !important; font-weight:800 !important; font-size:15px !important; letter-spacing:.015em !important;
    padding:12px 18px !important; cursor:pointer;
    transition:background .12s ease, transform .08s ease, box-shadow .14s ease;
    box-shadow:0 2px 0 rgba(0,0,0,.25), 0 4px 6px rgba(0,0,0,.22);
  }
  .btn:hover{ background:#333 !important; transform:translateY(-1px);
    box-shadow:0 2px 0 rgba(0,0,0,.25), 0 6px 10px rgba(0,0,0,.25); }
  .btn:active{ background:#000 !important; transform:translateY(0);
    box-shadow:0 1px 0 rgba(0,0,0,.3), 0 3px 6px rgba(0,0,0,.2); }
  .btn[disabled]{ opacity:.55; cursor:default }
  .btn.ghost{ background:#fff !important; color:#111 !important; border:1px solid rgba(0,0,0,.18) !important; box-shadow:none !important; }

.actions.duo {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  align-items: stretch;
}

/* Base */
.btn {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  border-radius: 10px;
  padding: 14px 18px;
  font-size: 18px;
  font-weight: 500;
  border: 1px solid var(--chip-border, rgba(0,0,0,.22));
  cursor: pointer;
  transition: background .2s ease, color .2s ease, border-color .2s ease;
}
.btn .label { transition: opacity .2s ease; }
.btn .label.hover { opacity: 0; position: absolute; }

/* Scout: ghost → black */
.btn.ghost {
  background: transparent;
  color: var(--ink);
}
.btn.ghost:hover {
  background: var(--ink);
  color: var(--paper);
}
.btn.ghost:hover .label.default { opacity: 0; }
.btn.ghost:hover .label.hover   { opacity: 1; }

/* Blueprint: black → orange */
.btn.cta {
  background: var(--ink);
  color: var(--paper);
  border-color: transparent;
}
.btn.cta:hover {
  background: var(--accent); /* your Expedition orange */
  color: var(--paper);
}
.btn.cta:hover .label.default { opacity: 0; }
.btn.cta:hover .label.hover   { opacity: 1; }

@media (max-width:640px){ .actions.duo { grid-template-columns: 1fr; } }

  .actions.actions--form{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:12px;
  margin-top:10px;
  width:100%;
}
@media (max-width:720px){ .actions.actions--form{ grid-template-columns:1fr; } }

.btn{
  display:inline-flex; align-items:center; justify-content:center;
  height:48px; padding:0 16px; border-radius:10px;
  border:1px solid var(--chip-border, rgba(0,0,0,.22));
  font:600 16px/1 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  letter-spacing:.01em; white-space:nowrap; cursor:pointer;
  transition: background-color .18s ease, color .18s ease, border-color .18s ease;
}
.btn--full{ width:100%; }

.btn--ghost{ background:transparent; color:var(--ink); }
.btn--ghost:hover{ background:var(--ink); color:var(--paper); }

.btn--cta{ background:var(--ink); color:var(--paper); border-color:transparent; }
.btn--cta:hover{ background:var(--accent); color:var(--paper); }

.actions--form .btn{ overflow:hidden; text-overflow:ellipsis; }
 
  /* Right preview */
  .preview{background:transparent; padding:0}
  .page{background:transparent}
  .title{font-weight:900; letter-spacing:-.02em; line-height:1.02; font-size:clamp(48px,7vw,72px); margin:4px 8px 12px}
  .meta{display:grid; grid-template-columns:1fr 1fr; gap:6px 28px; padding:8px; margin:0 8px 12px;}
  .meta .cell{background:transparent !important; border:0 !important; padding:0 !important; box-shadow:none !important;}
  .meta .label{font-size:12px; letter-spacing:.12em; text-transform:uppercase; opacity:.65; margin-bottom:2px}
  .meta .value{font-size:clamp(18px,2.2vw,24px); line-height:1.28}
  @media (min-width:820px){ .meta{grid-template-columns:repeat(4,1fr);} }

  .hero{margin:0 8px 16px; border-radius:12px; overflow:hidden; border:1px solid var(--div)}
  .hero img{display:block; width:100%; height:auto; aspect-ratio:16/9; object-fit:cover; background:#ddd}

  /* Tabs + card */
  .tabs{margin:0 8px}
  .tablist{display:flex; gap:8px; padding:0; margin:0; list-style:none}
  .ei-tab{
    appearance:none; border:none; display:inline-flex; align-items:center; gap:8px; padding:10px 14px;
    font-weight:800; font-size:14px; background:#fff; border:1px solid var(--div); border-radius:12px; cursor:pointer;
    box-shadow:0 1px 0 rgba(0,0,0,.02);
  }
  .ei-tab[aria-selected="false"]{opacity:.78}
  .ei-tab[aria-selected="true"]{opacity:1; border-color:rgba(0,0,0,.22)}
  .card{
    background:#fff; border:1px solid var(--div); border-radius:12px; border-top-left-radius:0;
    padding:14px; position:relative; top:-1px; margin-bottom:16px; transition:opacity .18s ease, transform .18s ease;
  }
  .card.is-enter{ opacity:0; transform: translateY(4px); }
  .card.is-enter.is-on{ opacity:1; transform: translateY(0); }

  .subhead{margin:4px 0 10px; opacity:.8}
  .row{display:flex; gap:12px; align-items:flex-start; padding:8px 0; border-top:1px dashed var(--div-soft)}
  .row:first-of-type{border-top:0}
  .row .k{flex:0 0 220px; font-weight:800}
  @media (max-width:560px){ .row{flex-direction:column} .row .k{flex:0 0 auto} }
  .chips{display:flex; flex-wrap:wrap; gap:8px 10px}
  .chip{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; background:#fff; border:1px solid rgba(0,0,0,.18); border-radius:8px; font-size:14px}
  .chip.secondary{ background:#f5f5f5; border-color:rgba(0,0,0,.12); font-size:13.5px }
  .chip svg{
  width:16px;
  height:16px;
  flex:0 0 16px;
  opacity:.85;
}
.chip.secondary svg{
  opacity:.75;
}

.chip svg{
  width:16px;
  height:16px;
  flex:0 0 16px;
  opacity:.85;
}
.chip.secondary svg{
  opacity:.75;
}

/* ✅ PASTE NEW STEPS BAR CSS RIGHT HERE */
.chips--stepsbar{
  display:flex;
  flex-wrap: nowrap;
  gap:8px;
  align-items: stretch;
}

.chips--stepsbar .chip{
  flex: 1 1 0;
  min-width: 0;
  justify-content: center;
  padding: 8px 10px;
  font-size: 12.5px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

@media (max-width:560px){
  .chips--stepsbar{
    flex-direction: column;
  }
  .chips--stepsbar .chip{
    flex: 0 0 auto;
    justify-content: flex-start;
  }
}
  
  .muter{opacity:.6}
  .empty{
  margin: 0 8px 16px;
  padding: 14px;
  border-radius: 12px;
  background: #fff;
  border: 1px solid rgba(0,0,0,.12);
}

  /* CTA area */
  #blueprintCta{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:10px; }
  #blueprintCta small{ font-size:13px; opacity:.65; margin-top:1px; }
  #blueprintCta .btn-cta{
    appearance:none !important; border:none !important; padding:12px 18px !important; border-radius:8px !important;
    font-weight:800 !important; font-size:15px !important; line-height:1 !important; letter-spacing:.015em !important;
    background:#fe5733 !important; color:#fff !important;
    box-shadow:0 2px 0 rgba(0,0,0,.25), 0 4px 6px rgba(0,0,0,.22) !important;
    transition:transform .08s ease, box-shadow .14s ease, filter .14s ease !important; will-change:transform,box-shadow,filter;
  }
  #blueprintCta .btn-cta:hover{
    filter:brightness(1.05); transform:translateY(-1px);
    box-shadow:0 2px 0 rgba(0,0,0,.25), 0 6px 10px rgba(0,0,0,.25) !important;
  }
  #blueprintCta .btn-cta:active{
    transform:translateY(0); filter:brightness(.98);
    box-shadow:0 1px 0 rgba(0,0,0,.3), 0 3px 6px rgba(0,0,0,.2) !important;
  }

  /* Loader (inside card) */
  #scoutLoading{ display:flex; align-items:center; gap:14px; padding:16px; border:1px dashed var(--div); border-radius:12px; background:#fff; }
  #scoutLoading .spin{ width:22px; height:22px; border-radius:50%; border:3px solid rgba(0,0,0,.12); border-top-color:#fe5733; animation: ei-spin .8s linear infinite; }
  #scoutLoading .h{ font-weight:800; margin:0 0 4px; }
  #scoutLoading .p{ opacity:.65; font-size:13px; margin:0 0 10px; }
  #scoutLoading .bar{ position:relative; height:6px; background:rgba(0,0,0,.06); border-radius:999px; overflow:hidden;}
  #scoutLoading .bar span{ position:absolute; inset:0 auto 0 0; width:35%; background:#fe5733; border-radius:999px; animation: ei-sweep 1.1s ease-in-out infinite; }

  @keyframes ei-spin { to { transform: rotate(360deg); } }
  @keyframes ei-sweep { 0%{left:-35%;width:35%} 50%{left:35%;width:40%} 100%{left:100%;width:35%} }

  /* =========================
   Blueprint Build Overlay (match Scout loader)
   ========================= */
.ei-buildOverlay{
  position:fixed; inset:0;
  background:rgba(0,0,0,.55);
  display:flex; align-items:center; justify-content:center;
  z-index:9999;
  padding:24px;
}
.ei-buildOverlay{ display:flex; }
.ei-buildOverlay[hidden]{ display:none; }

.ei-buildCard{
  width:min(560px, 92vw);
  background:#fff;
  border-radius:14px;
  padding:16px 16px 14px;
  border:1px solid rgba(0,0,0,.12);
  box-shadow:0 14px 40px rgba(0,0,0,.22);
}

.ei-buildTop{
  display:flex;
  gap:14px;
  align-items:flex-start;
}

.ei-buildCard .spin{
  width:22px; height:22px;
  border-radius:50%;
  border:3px solid rgba(0,0,0,.12);
  border-top-color:var(--accent);
  animation: ei-spin .8s linear infinite;
  margin-top:2px;
}

.ei-buildCard.is-done .spin{
  animation: none !important;
  border-top-color: rgba(0,0,0,.12) !important; /* match the other segments */
}
  
.ei-buildCard .h{ font-weight:800; margin:0 0 4px; font-size:18px; }
.ei-buildCard .p{ opacity:.65; font-size:13px; margin:0 0 10px; line-height:1.4; }

.ei-buildCard .bar{
  position:relative;
  height:6px;
  background:rgba(0,0,0,.06);
  border-radius:999px;
  overflow:hidden;
  margin-top:6px;
}
.ei-buildCard .bar span{
  position:absolute; inset:0 auto 0 0;
  width:35%;
  background:var(--accent);
  border-radius:999px;
  animation: ei-sweep 1.1s ease-in-out infinite;
}

#eiBuildBar{
  animation: none !important;
  width: 0%;
}

.ei-buildLog{
  margin-top:10px;
  border:1px dashed var(--div);
  border-radius:12px;
  padding:10px 12px;
  background:#fff;
  font-size:12px;
  opacity:.75;
  line-height:1.45;
}
.ei-buildLog .line{ margin:0 0 6px; }
.ei-buildLog .line:last-child{ margin:0; }

.ei-buildDone{
  margin-top:12px;
  display:flex;
  gap:10px;
  align-items:center;
}
.ei-buildBtn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  background:var(--accent);
  color:#fff;
  text-decoration:none;
  padding:12px 14px;
  border-radius:10px;
  font-weight:800;
}
.ei-buildSlug{ font-size:12px; opacity:.65; }

.ei-buildErr{
  margin-top:12px;
  font-size:13px;
  color:#b00020;
}

  /* Mobile tweaks */
  @media (max-width:640px){
    .shell{padding:10px; gap:10px}
    .form-panel.panel{padding:12px}
    #scoutForm.grp{grid-template-columns:1fr; gap:8px}
    .title{font-size:clamp(28px,8vw,40px); margin:6px 8px}
    .meta{grid-template-columns:1fr 1fr; gap:6px 10px}
    .hero{margin:0 8px 10px}
    .tablist{gap:6px}
    .ei-tab{padding:8px 10px; font-size:13px}
    .card{padding:12px}
    .btn, .btn-cta{width:100%}
  }
  /* required / optional markers driven by classes */
#scoutForm label.is-required::after{
  content:" *";
  color:#fe5733;
  font-weight:700;
}
#scoutForm label.is-optional::after{
  content:" (optional)";
  opacity:.55;
  font-weight:500;
}
/* opt-out support if you add data-no-auto on a label */
#scoutForm label[data-no-auto]::after{ content:none !important; }
  /* ===== CLEAN SELECT STYLING FIX ===== */

/* Remove native arrows (Chrome, Safari, Firefox) */
#scoutForm select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  text-overflow: ellipsis;          /* avoids clipping long placeholder */
  white-space: nowrap;
  overflow: hidden;
}

/* Custom single arrow (SVG) — perfectly aligned, replaces double */
#scoutForm select {
  background-image:
    linear-gradient(to bottom, transparent, transparent),
    url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%23111' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><polyline points='6 9 12 15 18 9'/></svg>");
  background-repeat: no-repeat;
  background-position: right 14px center;
  background-size: 18px;
  padding-right: 40px; /* space for custom arrow */
}

/* Force consistent vertical alignment */
#scoutForm select option {
  line-height: 1.4;
  padding: 4px 6px;
}
  /* ===== Date Input Placeholder Refinement ===== */

/* Target only the trip date field */
#tripDate {
  font-size: 15px !important;
  letter-spacing: 0.03em;
  text-align: left;
  padding-left: 12px;
}

/* Shrink and lighten placeholder text */
#tripDate::placeholder {
  font-size: 13px;
  letter-spacing: 0.05em;
  color: rgba(0,0,0,0.45);
}

/* Ensure calendar icon stays vertically centered */
#tripDate::-webkit-calendar-picker-indicator {
  margin-left: -2px;
  opacity: 0.8;
  cursor: pointer;
}
  /* ===== Global placeholder size refinement ===== */
#scoutForm ::placeholder {
  font-size: 13px !important;
  letter-spacing: 0.03em;
  color: rgba(0,0,0,0.45) !important;
}

/* Match placeholder feel for selects */
#scoutForm select {
  font-size: 15px !important;
}

/* Compact dropdown labels so “Select From Dropdown” fits cleanly */
#scoutForm select option:first-child {
  font-size: 13px !important;
  color: rgba(0,0,0,0.5);
}
/* ↓ Smaller text inside selects so long placeholder fits */
#scoutForm select{
  font-size: 14px !important;          /* was 16 */
  padding-right: 38px;                  /* keep room for arrow */
}
#scoutForm select option{ font-size: 14px !important; }

/* Make it even smaller only while the placeholder is selected */
#scoutForm select:has(option[value=""]:checked){
  font-size: 13px !important;
  letter-spacing: 0;
}

/* ↓ Date input: full width + shrink text + kill iOS blue */
#scoutForm input[type="date"]{
  width: 100% !important;
  box-sizing: border-box !important;
  display: block !important;

  font-size: 14px !important;           /* was 16 */
  background: #fff !important;          /* match other fields */
  color: #222 !important;
  -webkit-text-fill-color: #222 !important;
  -webkit-appearance: none;             /* strip iOS native styling */
}

#scoutForm input[type="date"]::-webkit-datetime-edit{
  font-size: 14px !important;
}

#scoutForm input[type="date"]::placeholder{
  font-size: 14px !important;
}

/* Clean, non-blue focus state */
#scoutForm input[type="date"]:focus {
  background: #fff !important;
  outline: 0;
  border-color: rgba(0,0,0,.28);
  box-shadow: 0 0 0 3px rgba(0,0,0,.06);
}
  .hero figcaption {
  font-size: 12px;
  opacity: .7;
  padding: 6px 8px;
  background: #fff;
  border-top: 1px solid var(--div);
}
  /* Hero loading overlay */
.hero{ position:relative; } /* ensure overlay positions correctly */
#hero_loading{
  position:absolute; inset:auto 8px 8px 8px;  /* bottom bar */
  display:flex; align-items:center; gap:10px;
  padding:10px 12px; border:1px solid var(--div); border-radius:10px;
  background:rgba(255,255,255,.92); backdrop-filter:saturate(1.2) blur(2px);
  box-shadow:0 2px 10px rgba(0,0,0,.08);
  font-size:13px; line-height:1.3;
}
#hero_loading[hidden]{ display:none; }
#hero_loading .spin{
  width:18px; height:18px; border-radius:50%;
  border:3px solid rgba(0,0,0,.12); border-top-color:var(--accent);
  animation: ei-spin .8s linear infinite;
}
  #pv_hero {
  background: linear-gradient(145deg, #f2f2f2, #d9d9d9);
  object-fit: cover;
}
  #hero_loading {
  position: absolute;
  inset: 0;                       /* fill the image frame */
  display: flex;
  align-items: center;
  justify-content: center;        /* center horizontally & vertically */
  gap: 10px;
  background: rgba(255,255,255,0.85);
  backdrop-filter: saturate(1.2) blur(3px);
  border-radius: 12px;
  font-size: 13px;
  line-height: 1.3;
  z-index: 2;
}

#hero_loading[hidden] {
  display: none;
}
  /* =========================
   FINAL OVERRIDES (buttons)
   ========================= */

/* 1) Lock the actions row to a 2-col grid on desktop */
.actions.actions--form{
  display: grid !important;
  grid-template-columns: 1fr 1fr !important;
  gap: 14px !important;
  width: 100% !important;
  margin-top: 12px !important;
  box-sizing: border-box;
}

/* 2) Only stack on small screens (tighten breakpoint) */
@media (max-width: 560px){
  .actions.actions--form{ grid-template-columns: 1fr !important; }
}

/* 3) Normalize the base button so “ghost” can actually be transparent */
.actions.actions--form .btn{
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  height: 52px !important;
  padding: 0 22px !important;
  width: 100% !important;
  border-radius: 10px !important;
  border: 1px solid var(--chip-border, rgba(0,0,0,.22)) !important;
  box-sizing: border-box !important;

  /* make sure no global .btn background bleeds in */
  background: transparent !important;
  color: var(--ink) !important;

  font: 600 17px/1.1 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif !important;
  letter-spacing: .01em !important;

  transition: background-color .2s ease, color .2s ease, border-color .2s ease !important;
  white-space: nowrap !important;
  overflow: visible !important;
  text-overflow: unset !important;
}

/* 4) Scout: ghost by default, black on hover */
.actions.actions--form .btn--ghost{
  background: transparent !important;
  color: var(--ink) !important;
  border-color: var(--chip-border, rgba(0,0,0,.22)) !important;
}
.actions.actions--form .btn--ghost:hover{
  background: var(--ink) !important;
  color: var(--paper) !important;
}

/* 5) Blueprint: black by default, Expedition Orange on hover */
.actions.actions--form .btn--cta{
  background: var(--ink) !important;
  color: var(--paper) !important;
  border-color: transparent !important;
}
.actions.actions--form .btn--cta:hover{
  background: var(--accent, #FF6A00) !important;  /* fallback orange */
  color: var(--paper) !important;
}
  /* =========================
   ACTION BUTTONS — FINAL OVERRIDES
   ========================= */

/* Keep buttons inside the form column and prevent grid overflow */
.actions.actions--form{
  display: grid !important;
  grid-template-columns: minmax(0,1fr) minmax(0,1fr) !important; /* <- key: allows shrinking */
  gap: 14px !important;
  width: 100% !important;
  margin-top: 12px !important;
  box-sizing: border-box !important;
  align-self: stretch !important;    /* stay within the form’s column */
  justify-self: stretch !important;
}
.actions.actions--form > *{ min-width: 0 !important; } /* prevent content from widening the grid */

/* Stack only when the LEFT FORM column gets narrow */
@media (max-width: 900px){
  .actions.actions--form{ grid-template-columns: 1fr !important; }
}

/* Uniform button sizing/typography (no overflow, no wrapping) */
.actions.actions--form .btn{
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  height: 52px !important;
  padding: 0 22px !important;
  width: 100% !important;
  max-width: 100% !important;
  min-width: 0 !important;
  border-radius: 10px !important;
  border: 1px solid var(--chip-border, rgba(0,0,0,.22)) !important;
  box-sizing: border-box !important;

  background: transparent !important;     /* base = transparent so ghost works */
  color: var(--ink) !important;

  font: 600 17px/1.1 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif !important;
  letter-spacing: .01em !important;
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;

  transition: background-color .2s ease, color .2s ease, border-color .2s ease !important;
}

/* Scout: ghost default → black hover */
.actions.actions--form .btn--ghost{
  background: transparent !important;
  color: var(--ink) !important;
  border-color: var(--chip-border, rgba(0,0,0,.22)) !important;
}
.actions.actions--form .btn--ghost:hover{
  background: var(--ink) !important;
  color: var(--paper) !important;
}

/* Blueprint: black default → orange hover */
.actions.actions--form .btn--cta{
  background: var(--ink) !important;
  color: var(--paper) !important;
  border-color: transparent !important;
}
.actions.actions--form .btn--cta:hover{
  background: var(--accent, #ff6a00) !important; /* fallback orange */
  color: var(--paper) !important;
}
  /* ==============================
   FINAL – FORM ACTION BUTTONS
   ============================== */

/* container: always full width, always stacked */
.actions.actions--form {
  display: flex !important;
  flex-direction: column !important;
  align-items: stretch !important;
  justify-content: flex-start !important;
  width: 100% !important;
  margin-top: 16px !important;
  gap: 10px !important;          /* space between buttons */
  box-sizing: border-box !important;
}

/* button base */
.actions.actions--form .btn {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  height: 52px !important;
  width: 100% !important;
  border-radius: 10px !important;
  border: 1px solid var(--chip-border, rgba(0,0,0,.22)) !important;
  font: 600 17px/1.1 "Helvetica Neue", Helvetica, Arial, sans-serif !important;
  letter-spacing: .01em !important;
  text-align: center !important;
  white-space: nowrap !important;
  cursor: pointer !important;
  transition: background-color .18s ease, color .18s ease !important;
  box-sizing: border-box !important;
}

/* Scout (ghost default → black on hover) */
.actions.actions--form .btn--ghost {
  background: transparent !important;
  color: var(--ink) !important;
}
.actions.actions--form .btn--ghost:hover {
  background: var(--ink) !important;
  color: var(--paper) !important;
}

/* Blueprint (black default → orange on hover) */
.actions.actions--form .btn--cta {
  background: var(--ink) !important;
  color: var(--paper) !important;
  border-color: transparent !important;
}
.actions.actions--form .btn--cta:hover {
  background: var(--accent, #ff6a00) !important;
  color: var(--paper) !important;
}
  .ei-footer {
  background: #111;
  color: #f5f5f5;
  padding: 20px 16px 28px;
  font-size: 11px;
}

.ei-footer-inner {
  max-width: 960px;
  margin: 0 auto;
  text-align: center;
}

/* Mission notice line */
.ei-footer-mission {
  color: #ff6a00; /* Expedition Intel orange */
  text-transform: uppercase;
  letter-spacing: 0.06em;
  line-height: 1.6;
  border-top: 1px solid rgba(255, 255, 255, 0.2);
  padding-top: 8px;
  margin: 0 0 12px;
}

/* © line */
.ei-footer-meta {
  margin: 0 0 4px;
}

/* Links line */
.ei-footer-links {
  margin: 0;
}

.ei-footer a {
  color: #ff6a00;
  text-decoration: none;
}

.ei-footer a:hover {
  text-decoration: underline;
}

.ei-footer-separator {
  display: inline-block;
  padding: 0 6px;
  opacity: 0.7;
}

/* Card container polish */
#optCard {
  border-radius: 12px;
  padding: 20px 24px;
  background: #f7f7f7;
  border: 1px solid #e3e3e3;
}

/* General text in the card */
#optCard .subhead.muter {
  font-size: 12px;
  line-height: 1.6;
  color: #555;
  margin-bottom: 0.75rem;
}

/* Risk label styling (the bold line) */
#optCard .subhead.muter strong {
  display: block;
  font-size: 11px;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: #ff6a00; /* your orange */
  margin-bottom: 4px;
}

/* Terms/Privacy line */
#optCard .subhead.muter a {
  text-decoration: underline;
  font-weight: 500;
}

  #optCard {
  text-align: center;
}

#optCard .subhead.muter {
  text-align: center;
}

  /* Make links in the options card orange */
#optCard a {
  color: #ff6a00;
  text-decoration: underline;
  font-weight: 500;
}

#optCard a:hover {
  text-decoration: none;
}

  /* Match options card width to hero image */
#optCard {
  margin: 0 8px 16px;           /* same horizontal insets as .hero */
  border-radius: 12px;
  padding: 20px 24px;
  background: #f7f7f7;
  border: 1px solid #e3e3e3;
}

  /* Softer, pill-style tabs that float more */
.tablist{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  padding:0;
  margin:0 8px 8px;        /* align with hero/card insets */
  list-style:none;
  justify-content:center;  /* center them under the image */
}

.ei-tab{
  appearance:none;
  border:1px solid var(--div);
  background:#fff;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  padding:8px 14px;
  border-radius:999px;                         /* full pill */
  font-weight:700;
  font-size:12px;
  letter-spacing:0.08em;
  text-transform:uppercase;
  cursor:pointer;
  box-shadow:0 2px 4px rgba(0,0,0,.04);
  transition:
    border-color .15s ease,
    box-shadow .15s ease,
    background-color .15s ease,
    transform .1s ease,
    opacity .12s ease;
}

.ei-tab[aria-selected="false"]{
  opacity:.7;
}

.ei-tab[aria-selected="true"]{
  opacity:1;
  background:#fff5ec;
  border-color:#ff6a00;
  color:#111;
  box-shadow:0 4px 10px rgba(0,0,0,.08);
  transform:translateY(-1px);
}

.ei-tab:hover{
  border-color:#ff6a00;
  box-shadow:0 3px 6px rgba(0,0,0,.08);
  transform:translateY(-1px);
}

  /* Tabs wrapper: match hero/card insets */
.tabs{
  margin: 0 8px 8px;   /* same horizontal margin as .hero and #optCard */
}

/* Tab list: full width inside that wrapper */
.tablist{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  padding:0;
  margin:0;
  list-style:none;
  justify-content:flex-start;  /* no centering, align like chips */
}

  /* Chip-style option tabs (no pills) */
.ei-tab{
  appearance:none;
  border:1px solid rgba(0,0,0,.18);
  background:#f5f5f5;                  /* like .chip.secondary */
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:8px 12px;
  border-radius:8px;                   /* match chip radius */
  font-weight:700;
  font-size:13px;
  letter-spacing:.02em;
  text-transform:none;                 /* text is already “OPTION 1 — …” */
  cursor:pointer;
  box-shadow:0 1px 0 rgba(0,0,0,.02);
  transition:
    background-color .15s ease,
    border-color .15s ease,
    box-shadow .15s ease,
    opacity .12s ease;
}

.ei-tab[aria-selected="false"]{
  opacity:.8;
}

.ei-tab[aria-selected="true"]{
  opacity:1;
  background:#fff;
  border-color:#ff6a00;                /* brand orange */
  box-shadow:0 2px 4px rgba(0,0,0,.08);
}

.ei-tab:hover{
  background:#fff;
  border-color:#ff6a00;
}

  @media (max-width:640px){
  .tablist{
    gap:6px;
  }

  /* Allow tabs to wrap but keep a clean grid feel */
  .ei-tab{
    flex: 1 1 calc(50% - 6px);  /* roughly 2-up on small screens */
    justify-content:center;
  }
}

  /* Scout options card: all content left-aligned */
#optCard,
#optCard p,
#optCard .subhead,
#optCard .subhead.muter,
#optCard .row,
#optCard .chips,
#optCard .empty {
  text-align: left;
}

  /* Kill iOS blue on selects (mobile + desktop) */
#scoutForm select {
  color: #222 !important;                 /* normal value color */
  -webkit-text-fill-color: #222 !important;
}

/* Placeholder state (when the empty option is selected) */
#scoutForm select:has(option[value=""]:checked) {
  color: rgba(0,0,0,0.45) !important;     /* softer grey for "Select From Dropdown" */
  -webkit-text-fill-color: rgba(0,0,0,0.45) !important;
}
  /* =========================
   EI NAV (Framer-match)
   ========================= */
.ei-nav{
  position:fixed; inset:0 0 auto 0;
  z-index:9999;
  pointer-events:none;
}
.ei-nav__bar{
  pointer-events:auto;
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 40px;
  background: var(--bg);
  position: relative;
  z-index: 2;
  padding-top: calc(10px + env(safe-area-inset-top));
  padding-left: calc(20px + env(safe-area-inset-left));
  padding-right: calc(20px + env(safe-area-inset-right));
}

.ei-nav__logo{ display:flex; align-items:center; width:80px; height:50px; text-decoration:none; }
.ei-nav__logo img{
  display:block;
  width:100%;
  height:100%;
  object-fit:contain;
  filter: brightness(0) saturate(100%); /* forces logo to black */
}

.ei-nav.is-open .ei-nav__logo img{
  filter: brightness(0) saturate(100%) !important; /* keep logo black */
  opacity: 1 !important;
}
  
.ei-nav__toggle{
  pointer-events:auto;
  width:50px; height:50px;
  display:grid; place-items:center;
  background:transparent; border:0; padding:0; cursor:pointer;
}

.ei-nav__icon{ width:28px; height:18px; position:relative; display:block; }
.ei-nav__line{
  position:absolute; left:0; right:0; height:2px;
  background: #1f1f1f;
  border-radius:10px;
  transition:transform .25s ease, top .25s ease, bottom .25s ease;
}
.ei-nav__line--top{ top:0; }
.ei-nav__line--bottom{ bottom:0; }

.ei-nav__overlay{
  opacity:0;
  visibility:hidden;          /* ✅ add */
  pointer-events:none;        /* ✅ keep */
  position:fixed; inset:0;
  background: var(--bg);
  transition:opacity .25s cubic-bezier(.44,0,.56,1), visibility 0s linear .25s; /* ✅ add */
  display:flex; align-items:center; justify-content:center;
  z-index: 1;
}

.ei-nav.is-open .ei-nav__overlay{
  opacity:1;
  visibility:visible;          /* ✅ add */
  pointer-events:auto;
  transition:opacity .25s cubic-bezier(.44,0,.56,1), visibility 0s; /* ✅ add */
}
  .ei-nav.is-open .ei-nav__line{
  background:#1f1f1f; /* force visible X */
}

.ei-nav__menu{
  pointer-events:auto;
  display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  text-align:center;
}
.ei-nav__link{
  font-family: "Poppins", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, sans-serif;
  font-weight:600;
  font-size:50px;
  line-height:1.1;
  text-transform:uppercase;
  text-decoration:none;
  color: var(--ink);
  transition: color .3s cubic-bezier(.44,0,.56,1);
}
.ei-nav__link:hover{ color: var(--accent); }
.ei-nav__link.is-active{ color: var(--accent); }

/* Open state */
.ei-nav.is-open .ei-nav__line--top{ top:8px; transform:rotate(45deg); }
.ei-nav.is-open .ei-nav__line--bottom{ bottom:8px; transform:rotate(-45deg); }

/* Make room for fixed nav */
.shell{ padding-top: 84px; }
@media (max-width: 900px){
  .ei-nav__bar{ padding:10px 20px; }
  .shell{ padding-top: 74px; }
}
.mode-toggle{
  display:flex;
  gap:8px;
}
.mode-btn{
  flex:1;
  height:40px;
  border-radius:10px;
  border:1px solid rgba(0,0,0,.18);
  background:#f5f5f5;
  font:600 13px/1 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  cursor:pointer;
}
.mode-btn.is-active{
  background:#fff;
  border-color: var(--accent);
  box-shadow:0 2px 6px rgba(0,0,0,.08);
}

</style>
</head>
<body>
<!-- === INLINE SVG SPRITE — EXACT TABLER ICONS YOU PROVIDED === --> 
  <svg aria-hidden="true"
     style="position:absolute;width:0;height:0;overflow:hidden"
     xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink="http://www.w3.org/1999/xlink">

  <!-- UI icons -->
  <symbol id="i-bookmark" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M18 7v14l-6 -4l-6 4v-14a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4z"/>
  </symbol>

  <symbol id="i-share" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M6 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"/>
    <path d="M18 6m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"/>
    <path d="M18 18m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"/>
    <path d="M8.7 10.7l6.6 -3.4"/>
    <path d="M8.7 13.3l6.6 3.4"/>
  </symbol>

  <symbol id="i-print" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M14 3v4a1 1 0 0 0 1 1h4"/>
    <path d="M5 12v-7a2 2 0 0 1 2 -2h7l5 5v4"/>
    <path d="M5 18h1.5a1.5 1.5 0 0 0 0 -3h-1.5v6"/>
    <path d="M17 18h2"/>
    <path d="M20 15h-3v6"/>
    <path d="M11 15v6h1a2 2 0 0 0 2 -2v-2a2 2 0 0 0 -2 -2h-1z"/>
  </symbol>

  <symbol id="i-compass" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M8 16l2 -6l6 -2l-2 6l-6 2"/>
    <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"/>
  </symbol>

  <symbol id="i-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0"/>
    <path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7"/>
  </symbol>

  <symbol id="i-pin" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M9 11a3 3 0 1 0 6 0a3 3 0 0 0 -6 0"/>
    <path d="M17.657 16.657l-4.243 4.243a2 2 0 0 1 -2.827 0l-4.244 -4.243a8 8 0 1 1 11.314 0z"/>
  </symbol>

<symbol id="i-calendar" viewBox="0 0 24 24"
        fill="none" stroke="currentColor"
        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 7a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v11a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"/>
  <path d="M16 3v4"/>
  <path d="M8 3v4"/>
  <path d="M4 11h16"/>
  <path d="M8 15h.01"/>
  <path d="M12 15h.01"/>
  <path d="M16 15h.01"/>
</symbol>

  <symbol id="i-download" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2"/>
    <path d="M7 11l5 5l5 -5"/>
    <path d="M12 4l0 12"/>
  </symbol>

  <symbol id="i-external" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M12 6h-6a2 2 0 0 0 -2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-6"/>
    <path d="M11 13l9 -9"/>
    <path d="M15 4h5v5"/>
  </symbol>

  <!-- Section-header icons (h-*) -->
  <symbol id="h-permits" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M15 21h-9a3 3 0 0 1 -3 -3v-1h10v2a2 2 0 0 0 4 0v-14a2 2 0 1 1 2 2h-2m2 -4h-11a3 3 0 0 0 -3 3v11"/>
    <path d="M9 7l4 0"/>
    <path d="M9 11l4 0"/>
  </symbol>

  <symbol id="h-shuttle" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M7 17m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"/>
    <path d="M17 17m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"/>
    <path d="M9 17h6"/>
    <path d="M19 17h1a1 1 0 0 0 1 -1v-4.528a2 2 0 0 0 -.211 -.894l-.96 -1.92a3 3 0 0 0 -2.683 -1.658h-11.146a3 3 0 0 0 -3 3v6a1 1 0 0 0 1 1h1"/>
    <path d="M3 12h18"/>
    <path d="M15 12v-5"/>
    <path d="M6 4m0 1.5a1.5 1.5 0 0 1 1.5 -1.5h7a1.5 1.5 0 0 1 1.5 1.5v0a1.5 1.5 0 0 1 -1.5 1.5h-7a1.5 1.5 0 0 1 -1.5 -1.5z"/>
  </symbol>

  <symbol id="h-timeline" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M12 20m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"/>
    <path d="M10 20h-6"/>
    <path d="M14 20h6"/>
    <path d="M12 15l-2 -2h-3a1 1 0 0 1 -1 -1v-8a1 1 0 0 1 1 -1h10a1 1 0 0 1 1 1v8a1 1 0 0 1 -1 1h-3l-2 2z"/>
    <path d="M13.5 9.5l-3 -3"/>
    <path d="M10.5 9.5l3 -3"/>
  </symbol>

  <symbol id="h-multitrail" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M14 5a2 2 0 0 0 -2 2v10a2 2 0 0 1 -2 2"/>
    <path d="M3 17h4v4h-4z"/>
    <path d="M17 3h4v4h-4z"/>
  </symbol>

  <symbol id="h-considerations" viewBox="0 0 24 24" fill="currentColor">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M8 4a2.599 2.599 0 0 0 -2 .957l-4.355 5.24a2.847 2.847 0 0 0 -.007 3.598l4.368 5.256c.499 .6 1.224 .949 1.994 .949a2.599 2.599 0 0 0 2 -.957l4.355 -5.24a2.847 2.847 0 0 0 .007 -3.598l-4.368 -5.256a2.593 2.593 0 0 0 -1.994 -.949z"/>
    <path d="M16.382 4.214a1 1 0 0 1 1.32 .074l.084 .094l4.576 5.823c.808 .993 .848 2.396 .13 3.419l-.12 .158l-4.586 5.836a1 1 0 0 1 -1.644 -1.132l.072 -.104l4.596 -5.85a.845 .845 0 0 0 .06 -.978l-.07 -.1l-4.586 -5.836a1 1 0 0 1 .168 -1.404z"/>
    <path d="M12.382 4.214a1 1 0 0 1 1.32 .074l.084 .094l4.576 5.823c.808 .993 .848 2.396 .13 3.419l-.12 .158l-4.586 5.836a1 1 0 0 1 -1.644 -1.132l.072 -.104l4.596 -5.85a.845 .845 0 0 0 .06 -.978l-.07 -.1l-4.586 -5.836a1 1 0 0 1 .168 -1.404z"/>
  </symbol>

  <symbol id="h-itinerary" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M12 18.5l-3 -1.5l-6 3v-13l6 -3l6 3l6 -3v8"/>
    <path d="M9 4v13"/>
    <path d="M15 7v6.5"/>
    <path d="M19.001 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"/>
    <path d="M19.001 15.5v1.5"/>
    <path d="M19.001 21v1.5"/>
    <path d="M22.032 17.25l-1.299 .75"/>
    <path d="M17.27 20l-1.3 .75"/>
    <path d="M15.97 17.25l1.3 .75"/>
    <path d="M20.733 20l1.3 .75"/>
  </symbol>

  <symbol id="h-gpx" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M3 7l6 -3l6 3l6 -3v13l-6 3l-6 -3l-6 3v-13"/>
    <path d="M9 12v.01"/>
    <path d="M6 13v.01"/>
    <path d="M17 15l-4 -4"/>
    <path d="M13 15l4 -4"/>
  </symbol>

  <symbol id="h-campsite" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M11 14l4 6h6l-9 -16l-9 16h6l4 -6"/>
  </symbol>

  <symbol id="h-weather" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M7 18a4.6 4.4 0 0 1 0 -9a5 4.5 0 0 1 11 2h1a3.5 3.5 0 0 1 0 7h-1"/>
    <path d="M13 14l-2 4l3 0l-2 4"/>
  </symbol>

  <symbol id="h-gear" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M3.5 5.5l1.5 1.5l2.5 -2.5"/>
    <path d="M3.5 11.5l1.5 1.5l2.5 -2.5"/>
    <path d="M3.5 17.5l1.5 1.5l2.5 -2.5"/>
    <path d="M11 6l9 0"/>
    <path d="M11 12l9 0"/>
    <path d="M11 18l9 0"/>
  </symbol>

  <symbol id="h-optional" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M4 8h4v4h-4z"/>
    <path d="M6 4l0 4"/>
    <path d="M6 12l0 8"/>
    <path d="M10 14h4v4h-4z"/>
    <path d="M12 4l0 10"/>
    <path d="M12 18l0 2"/>
    <path d="M16 5h4v4h-4z"/>
    <path d="M18 4l0 1"/>
    <path d="M18 9l0 11"/>
  </symbol>

  <symbol id="h-risk" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M15.04 19.745c-.942 .551 -1.964 .976 -3.04 1.255a12 12 0 0 1 -8.5 -15a12 12 0 0 0 8.5 -3a12 12 0 0 0 8.5 3a12 12 0 0 1 .195 6.015"/>
    <path d="M19 16v3"/>
    <path d="M19 22v.01"/>
  </symbol>

  <symbol id="h-conditions" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
    <path d="M15.51 15.56a5 5 0 1 0 -3.51 1.44"/>
    <path d="M18.832 17.86a9 9 0 1 0 -6.832 3.14"/>
    <path d="M12 12v9"/>
  </symbol>

  <symbol id="h-bailout" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M13 12v.01"/>
    <path d="M3 21h18"/>
    <path d="M5 21v-16a2 2 0 0 1 2 -2h7.5m2.5 10.5v7.5"/>
    <path d="M14 7h7m-3 -3l3 3l-3 3"/>
  </symbol>

  <symbol id="h-emergency" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M12 8a2 2 0 0 1 2 2v4a2 2 0 1 1 -4 0v-4a2 2 0 0 1 2 -2"/>
    <path d="M17 15c.345 .6 1.258 1 2 1a2 2 0 1 0 0 -4a2 2 0 1 1 0 -4c.746 0 1.656 .394 2 1"/>
    <path d="M3 15c.345 .6 1.258 1 2 1a2 2 0 1 0 0 -4a2 2 0 1 1 0 -4c.746 0 1.656 .394 2 1"/>
  </symbol>

  <symbol id="h-final" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M8 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h5.697"/>
    <path d="M18 14v4h4"/>
    <path d="M18 11v-4a2 2 0 0 0 -2 -2h-2"/>
    <path d="M8 3m0 2a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v0a2 2 0 0 1 -2 2h-2a2 2 0 0 1 -2 -2z"/>
    <path d="M18 18m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0"/>
    <path d="M8 11h4"/>
    <path d="M8 15h3"/>
  </symbol>

  <symbol id="h-disclaimer" viewBox="0 0 24 24" fill="currentColor">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M12 1.67c.955 0 1.845 .467 2.39 1.247l.105 .16l8.114 13.548a2.914 2.914 0 0 1 -2.307 4.363l-.195 .008h-16.225a2.914 2.914 0 0 1 -2.582 -4.2l.099 -.185l8.11 -13.538a2.914 2.914 0 0 1 2.491 -1.403zm.01 13.33l-.127 .007a1 1 0 0 0 0 1.986l.117 .007l.127 -.007a1 1 0 0 0 0 -1.986l-.117 -.007zm-.01 -7a1 1 0 0 0 -.993 .883l-.007 .117v4l.007 .117a1 1 0 0 0 1.986 0l.007 -.117v-4l-.007 -.117a1 1 0 0 0 -.993 -.883z"/>
  </symbol>

  <!-- Chips (c-*) -->
  <symbol id="c-distance" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M19.875 8c.621 0 1.125 .512 1.125 1.143v5.714c0 .631 -.504 1.143 -1.125 1.143h-15.875a1 1 0 0 1 -1 -1v-5.857c0 -.631 .504 -1.143 1.125 -1.143h15.75z"/>
    <path d="M9 8v2"/>
    <path d="M6 8v3"/>
    <path d="M12 8v3"/>
    <path d="M18 8v3"/>
    <path d="M15 8v2"/>
  </symbol>

  <symbol id="c-elevation" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M3 20h18l-6.921 -14.612a2.3 2.3 0 0 0 -4.158 0l-6.921 14.612z"/>
    <path d="M7.5 11l2 2.5l2.5 -2.5l2 3l2.5 -2"/>
  </symbol>

  <symbol id="c-trail" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M12 21v-4"/>
    <path d="M12 13v-4"/>
    <path d="M12 5v-2"/>
    <path d="M10 21h4"/>
    <path d="M8 5v4h11l2 -2l-2 -2z"/>
    <path d="M14 13v4h-8l-2 -2l2 -2z"/>
  </symbol>

  <symbol id="c-terrain" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M4.5 9.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
    <path d="M9.5 4.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
    <path d="M9.5 14.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
    <path d="M4.5 19.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
    <path d="M14.5 9.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
    <path d="M19.5 4.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
    <path d="M14.5 19.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
    <path d="M19.5 14.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
  </symbol>

  <symbol id="c-decision" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M16 3h5v5"/>
    <path d="M8 3h-5v5"/>
    <path d="M21 3l-7.536 7.536a5 5 0 0 0 -1.464 3.534v6.93"/>
    <path d="M6 6.01v-.01"/>
    <path d="M8 8.02v-.01"/>
    <path d="M10 10v.01"/>
  </symbol>

  <symbol id="c-morale" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M5 7h1a2 2 0 0 0 2 -2a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v9a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2"/>
    <path d="M9 13a3 3 0 1 0 6 0a3 3 0 0 0 -6 0"/>
  </symbol>

<symbol id="c-safety" viewBox="0 0 24 24"
        fill="none" stroke="currentColor"
        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M12 4l8 4v6a8 8 0 1 1 -16 0v-6z"/>
  <path d="M9 12l2 2l4 -4"/>
</symbol>

  <symbol id="c-water" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M7.502 19.423c2.602 2.105 6.395 2.105 8.996 0c2.602 -2.105 3.262 -5.708 1.566 -8.546l-4.89 -7.26c-.42 -.625 -1.287 -.803 -1.936 -.397a1.376 1.376 0 0 0 -.41 .397l-4.893 7.26c-1.695 2.838 -1.035 6.441 1.567 8.546z"/>
  </symbol>

  <symbol id="c-campsite" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M11 14l4 6h6l-9 -16l-9 16h6l4 -6"/>
  </symbol>

  <symbol id="c-gps" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"/>
    <path d="M12 12m-8 0a8 8 0 1 0 16 0a8 8 0 1 0 -16 0"/>
    <path d="M12 2l0 2"/>
    <path d="M12 20l0 2"/>
    <path d="M20 12l2 0"/>
    <path d="M2 12l2 0"/>
  </symbol>
  
  <symbol id="c-duration" viewBox="0 0 24 24"
        fill="none" stroke="currentColor"
        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M3 13a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />
  <path d="M9 9a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />
  <path d="M15 5a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />
  <path d="M4 20h14" />
</symbol>

  <!-- New chips -->
  <symbol id="c-features" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M9.718 17.359l-.718 -.359l-6 3v-13l6 -3l6 3l6 -3v7.5" />
    <path d="M9 4v13" />
    <path d="M15 7v4" />
    <path d="M17.8 20.817l-2.172 1.138a.392 .392 0 0 1 -.568 -.41l.415 -2.411l-1.757 -1.707a.389 .389 0 0 1 .217 -.665l2.428 -.352l1.086 -2.193a.392 .392 0 0 1 .702 0l1.086 2.193l2.428 .352a.39 .39 0 0 1 .217 .665l-1.757 1.707l.414 2.41a.39 .39 0 0 1 -.567 .411l-2.172 -1.138z" />
  </symbol>

  <symbol id="c-tip" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" />
    <path d="M12 9h.01" />
    <path d="M11 12h1v4h1" />
  </symbol>

  <symbol id="c-bailout" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M13 12v.01" />
    <path d="M3 21h18" />
    <path d="M5 21v-16a2 2 0 0 1 2 -2h7.5m2.5 10.5v7.5" />
    <path d="M14 7h7m-3 -3l3 3l-3 3" />
  </symbol> 

<!-- === Scenario tab symbols (append before </svg>) === -->
  <symbol id="tab-baseline" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <ellipse cx="12" cy="6" rx="8" ry="3" />
    <path d="M4 6v6a8 3 0 0 0 16 0v-6" />
    <path d="M4 12v6a8 3 0 0 0 16 0v-6" />
  </symbol>

  <symbol id="tab-anchor" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M12.857 14.675a5.016 5.016 0 0 1 -.857 -.675a5 5 0 0 0 -7 0v-9a5 5 0 0 1 7 0a5 5 0 0 0 7 0v6" />
    <path d="M5 21v-7" />
    <path d="M21.121 20.121a3 3 0 1 0 -4.242 0c.418 .419 1.125 1.045 2.121 1.879c1.051 -.89 1.759 -1.516 2.121 -1.879z" />
    <path d="M19 18v.01" />
  </symbol>

  <symbol id="tab-driven" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
    <path d="M5.636 19.364a9 9 0 1 1 12.728 0" />
    <path d="M16 9l-4 4" />
  </symbol>
</svg>
  
  <header class="ei-nav" data-ei-nav>
  <div class="ei-nav__bar">
    <a class="ei-nav__logo" href="https://www.expeditionintel.com/#hero" aria-label="Expedition Intel Home">
      <img
        src="https://framerusercontent.com/images/G49qHOFRK9sYqNH3Pwj4OuzH6k.svg"
        alt="Expedition Intel"
        width="78"
        height="30"
      />
    </a>

    <button class="ei-nav__toggle" type="button" aria-label="Open menu" aria-expanded="false" data-ei-nav-toggle>
      <span class="ei-nav__icon" aria-hidden="true">
        <span class="ei-nav__line ei-nav__line--top"></span>
        <span class="ei-nav__line ei-nav__line--bottom"></span>
      </span>
    </button>
  </div>

  <div class="ei-nav__overlay" data-ei-nav-overlay>
<nav class="ei-nav__menu" aria-label="Primary">
  <a class="ei-nav__link" href="https://www.expeditionintel.com/" data-ei-nav-link>HOME</a>

  <a class="ei-nav__link" href="https://trip.expeditionintel.com/preview/" data-ei-nav-link>
    BUILD
  </a>

  <a class="ei-nav__link" href="https://www.expeditionintel.com/stories" data-ei-nav-link>DEBRIEF</a>
  <a class="ei-nav__link" href="https://www.expeditionintel.com/contact-us" data-ei-nav-link>CONTACT</a>
</nav>
  </div>
</header>

  <main class="shell">
    <!-- LEFT: form -->
    <aside class="panel form-panel">
      <h2>Discover. Decide. Design.</h2>
      <p class="hero-intro">
  Start with recon or straight to the Blueprint. Your intel builds&nbsp;live.
</p>

      <form id="scoutForm" class="grp" novalidate>
        <!-- Trip title -->
        <div class="row-1">
          <label for="tripTitle">Trip title</label>
          <input id="tripTitle" name="title" data-ei-meta="title" placeholder="Zion West Rim Adventure"/>
        </div>

        <!-- Date + Based in -->
        <div>
          <label for="tripDate">Trip date</label>
          <input id="tripDate" type="date" name="tripDate" data-ei-meta="date" required/>
        </div>
        <div>
          <label for="fBasedIn">(City/State/Country)</label>
          <input id="fBasedIn" name="based_in" type="text" placeholder="Boulder, CO" required/>
        </div>

        <!-- Name + Email -->
        <div>
          <label for="fName">Name</label>
          <input id="fName" name="name" type="text" placeholder="Jane Rider" required/>
        </div>
        <div>
          <label for="fEmail">Email</label>
          <input id="fEmail" name="email" type="email" placeholder="jane@domain.com" required/>
        </div>

        <!-- Experience + Primary Objective -->
        <div>
          <label for="fExp">Experience level</label>
          <select id="fExp" name="experience_level" required>
            <option value="">— Select —</option>
            <option>Beginner</option>
            <option>Intermediate</option>
            <option>Advanced</option>
            <option>Elite</option>
          </select>
        </div>
        <div>
          <label for="fObjective">Primary Objective?</label>
          <select id="fObjective" name="primary_objective" data-ei-meta="category" required>
            <option value="">Select From Dropdown</option>
            <option>Out and Back</option>
            <option>Loop Hike</option>
            <option>End-To-End Traverse</option>
            <option>Peak Summit / High Alpine Trekking</option>
            <option>Multi Week Section Hike (Long Trail)</option>
            <option>Full Through Hike (Long Trail)</option>
            <option>Summit Expedition</option>
            <option>Packrafting / Paddling Expedition</option>
            <option>Hybrid / Multi-Sport Traverse</option>
          </select>
        </div>

       <!-- Ideal trip length + Preferred terrain -->
<div>
<label for="fLength">Ideal trip length (days on trail)</label>
<select id="fLength" name="ideal_trip_length" required>
  <option value="">Select From Dropdown</option>
  <option value="1–2">1–2 days (overnight / quick hit)</option>
  <option value="3–4">3–4 days (long weekend)</option>
  <option value="5–7">5–7 days (week-long)</option>
  <option value="8+">8+ days (extended expedition)</option>
</select>
</div>

        <div>
        <label for="fTerrain">Preferred terrain</label>
<select id="fTerrain" name="preferred_terrain" required>
  <option value="">Select From Dropdown</option>
  <option>Alpine Lakes & Basins</option>
  <option>Mountains & Ridges</option>
  <option>Coastal / Sea Cliffs</option>
  <option>Forest</option>
  <option>Deep Forest / Rainforest</option>
  <option>Rivers</option>
  <option>Lakes & Inland Waterways</option> <!-- NEW -->
  <option>River Corridors & Gorges</option>
  <option>Desert</option>
  <option>High Desert / Plateau</option>
  <option>Glacial / Snowfield</option>
  <option>Scrambling & Peakbagging</option>
  <option>Canyons & Red Rock</option>
  <option>Off-Trail / Cross-Country</option>
  <option>Gravel & Forest Roads (Bike)</option>
  <option>Paved Paths & Greenways (Bike)</option>
  <option>No Strong Preference / Mixed Terrain</option>
</select>
</div>

        <!-- Destination + idea -->
        <div>
          <label for="fDestination">Destination</label>
          <select id="fDestination">
            <option value="">Select From Dropdown</option>
            <option>I know exactly where</option>
            <option>I have a few ideas</option>
            <option>I want you to choose for me</option>
          </select>
        </div>
        <div>
  <label for="fIdea" data-no-auto>Destination idea</label>
  <input
    id="fIdea"
    name="destination_idea"
    data-ei-meta="location"
    type="text"
    placeholder="e.g., Mt Whitney, Lost Coast Trail…"
  />
</div>

        <!-- Additional details -->
        <div class="row-1">
          <label for="fAdditional">Additional details</label>
          <textarea id="fAdditional" name="additional" rows="5"
            placeholder="Add optional details such as preferred campsites, zero days, side hikes, milestones, dog or group needs, or conditions to plan around."></textarea>
        </div>

<!-- Actions -->
<div class="row-1" style="display:flex; gap:10px; align-items:center; margin-top:6px">
<div class="actions actions--form">
  <button id="btnGenerateScout" class="btn btn--ghost" type="submit">
    Discover Free Scout
  </button>

<div class="mode-toggle" id="bpMode" style="display:none">
  <button type="button" class="mode-btn is-active" data-mode="upgrade">Upgrade this Scout</button>
  <button type="button" class="mode-btn" data-mode="new">New Blueprint</button>
</div>
  
  <button id="btnBuyBlueprint" class="btn btn--cta" type="button">
    Advance to Expedition Blueprint $99
  </button>
  </div> <!-- closes .actions.actions--form -->
</div>   <!-- ✅ add this: closes the .row-1 wrapper -->
</form>
    </aside>

    <!-- RIGHT: live preview -->
    <section class="panel preview">
      <div class="page">
        <h1 class="title" id="pv_title">Type to Set Objective</h1>

        <div class="meta">
          <div class="cell"><div class="label">Category</div><div class="value" id="pv_category">—</div></div>
          <div class="cell"><div class="label">Season</div><div class="value" id="pv_season">—</div></div>
          <div class="cell"><div class="label">Location</div><div class="value" id="pv_location">—</div></div>
          <div class="cell"><div class="label">Date</div><div class="value" id="pv_date">—</div></div>
        </div>

        <figure class="hero">
  <img id="pv_hero"
     alt="Hero image"
     src="../assets/recon-placeholder.jpg"
     decoding="async"
     loading="eager" />

  <div id="hero_loading" hidden aria-live="polite">
    <div class="spin"></div>
    <span>Recon in progress — locating your terrain…</span>
  </div>

  <figcaption id="pv_credit" style="display:none;padding:6px 8px;font-size:13px;"></figcaption>
</figure>

        <nav class="tabs" aria-label="Options">
          <ul class="tablist" role="tablist" id="optTabs"></ul>
        </nav>

        <div class="card" id="optCard">

  <p class="subhead muter">
    <strong>Backcountry Risk Notice – Scout Recon</strong><br>
    This Scout Recon is planning intelligence only. Expedition Intel does not guide trips, supervise you in the field, or provide rescue or emergency services. Backcountry travel involves serious risks, including injury and
    death.  
  </p>

  <p class="subhead muter">
    By viewing and using this intel you acknowledge that you are solely responsible for verifying conditions, securing permits, preparing your team, and making all decisions in the field. Your use constitutes acceptance of
    the waiver, release, indemnity, and limitation‑of‑liability provisions in the Expedition Intel Terms of Service and the Privacy Policy.
  </p>

  <p class="subhead muter">
    Full details:
    <a href="https://www.expeditionintel.com/terms-of-service" target="_blank" rel="noopener noreferrer">
      Terms of Service
    </a>
    ·
    <a href="https://www.expeditionintel.com/privacy-policy" target="_blank" rel="noopener noreferrer">
      Privacy Policy
    </a>
  </p>

  <div class="empty">
 <div class="chips chips--stepsbar" style="margin:0 0 10px">
    <span class="chip secondary"><svg aria-hidden="true"><use href="#c-decision"></use></svg>Step 1: Complete Form</span>
    <span class="chip secondary"><svg aria-hidden="true"><use href="#c-features"></use></svg>Step 2: Discover Scout</span>
    <span class="chip secondary"><svg aria-hidden="true"><use href="#c-trail"></use></svg>Step 3: Review Options</span>
  </div>

  <div style="font-weight:800; margin:0 0 6px;">Awaiting intel.</div>
  <div style="opacity:.72; font-size:13px; line-height:1.5;">
    Three route options will populate here upon recon completion.
  </div>
</div>

  <div class="cta" id="blueprintCta" style="display:none">
    <button class="btn-cta" id="btnBlueprint" type="button" disabled>Blueprint this route →</button>
    <small id="ctaHint">Select an option above</small>
  </div>
</div>
    </section>
  </main>

  <footer class="ei-footer">
  <div class="ei-footer-inner">
    <p class="ei-footer-mission">
      MISSION NOTICE: Expedition Intel provides backcountry reconnaissance and route intelligence only. 
We do not guarantee the accuracy, completeness, or safety of any information, and we do not
provide guiding, rescue, or insurance services. The backcountry is unforgiving—injury,
exposure, and death are possible outcomes. 

By accessing this website, viewing any intel, and/or purchasing any product, you
acknowledge that you have read, understand, and agree to be bound by the
Expedition Intel Terms of Service—including the waiver, release, indemnification,
and limitation‑of‑liability provisions—and the Expedition Intel Privacy Policy.
You assume full responsibility for your choices, preparation, and safety in the
field.
    </p>

    <p class="ei-footer-meta">
      © 2025 Expedition Intel
    </p>

    <p class="ei-footer-links">
      <a href="https://www.expeditionintel.com/terms-of-service" target="_blank" rel="noopener noreferrer">
        Terms of Service
      </a>
      <span class="ei-footer-separator">|</span>
      <a href="https://www.expeditionintel.com/privacy-policy" target="_blank" rel="noopener noreferrer">
        Privacy Policy
      </a>
    </p>
  </div>
</footer>

<!-- EI BUILD OVERLAY (shows only when ?session_id=... is present) -->
<div id="eiBuildOverlay" class="ei-buildOverlay" hidden>
  <div class="ei-buildCard" role="status" aria-live="polite">
    <div class="ei-buildTop">
      <div class="spin" aria-hidden="true"></div>
      <div style="width:100%">
        <div class="h">Building Expedition Blueprint…</div>
        <div id="eiBuildMsg" class="p">Payment confirmed. Standing by for builder pickup…</div>

        <div class="bar" aria-hidden="true"><span id="eiBuildBar"></span></div>

        <div id="eiBuildStepLabel" class="p" style="margin-top:10px">
          Initializing…
        </div>

        <div id="eiBuildLog" class="ei-buildLog" style="display:none"></div>

        <div id="eiBuildDone" class="ei-buildDone" style="display:none">
          <a id="eiOpenBlueprint" href="#" target="_self" class="ei-buildBtn">
            Open Blueprint →
          </a>
          <span id="eiBuildSlug" class="ei-buildSlug"></span>
        </div>

        <div id="eiBuildErr" class="ei-buildErr" style="display:none">
          Build failed. Please refresh or contact support.
        </div>
      </div>
    </div>
  </div>
</div>
  
<script>
(() => {
  const root = document.querySelector("[data-ei-nav]");
  if (!root) return;

  const btn = root.querySelector("[data-ei-nav-toggle]");
  const overlay = root.querySelector("[data-ei-nav-overlay]");
  const links = root.querySelectorAll("[data-ei-nav-link]");

  const setOpen = (open) => {
    root.classList.toggle("is-open", open);
    btn.setAttribute("aria-expanded", String(open));
    btn.setAttribute("aria-label", open ? "Close menu" : "Open menu");
    document.body.classList.toggle("ei-nav-lock", open);
  };

  btn.addEventListener("click", () => setOpen(!root.classList.contains("is-open")));
  overlay.addEventListener("click", (e) => { if (e.target === overlay) setOpen(false); });
  document.addEventListener("keydown", (e) => { if (e.key === "Escape") setOpen(false); });
  links.forEach(a => a.addEventListener("click", () => setOpen(false)));

  // Active state based on path
const path = location.pathname.replace(/\/$/, "") || "/";
links.forEach(a => {
  try {
    const ap = new URL(a.href).pathname.replace(/\/$/, "") || "/";

    // exact match OR current page is within that section (e.g. /preview/success)
    const isActive = (ap === path) || (ap !== "/" && path.startsWith(ap));

    if (isActive) a.classList.add("is-active");
  } catch {}
});
})();

  let BLUEPRINT_MODE = "upgrade";

function setBlueprintMode(mode){
  BLUEPRINT_MODE = mode;
  const wrap = document.getElementById("bpMode");
  if (!wrap) return;
  wrap.querySelectorAll(".mode-btn").forEach(b=>{
    b.classList.toggle("is-active", b.dataset.mode === mode);
  });
}
  function updateLeftBlueprintCTA(){
  const modeWrap = document.getElementById("bpMode");
  const buyBtn = document.getElementById("btnBuyBlueprint");
  if (!buyBtn) return;

  const hasScout = !!(window.SCOUT?.options && window.SCOUT.options.length);

  // Toggle only appears after a Scout exists
  if (modeWrap) modeWrap.style.display = hasScout ? "flex" : "none";

  if (!hasScout) {
    buyBtn.textContent = "Advance to Expedition Blueprint $99";
    return;
  }

if (BLUEPRINT_MODE === "upgrade") {
  const optNum = (window.ACTIVE || 0) + 1;
  buyBtn.textContent = `Upgrade Option ${optNum} →`;
} else {
  buyBtn.textContent = "Start New Expedition Blueprint $99";
}

}
document.getElementById("bpMode")?.addEventListener("click", (e)=>{
  const b = e.target.closest(".mode-btn");
  if (!b) return;
  setBlueprintMode(b.dataset.mode);
  updateLeftBlueprintCTA();
});

</script>
<style>body.ei-nav-lock{overflow:hidden}</style>

  
  
<script>
/* ---------- tiny helpers ---------- */
const $id = (id)=>document.getElementById(id);
const chip = (t, secondary=false, iconId="") => {
  const ico = iconId
    ? `<svg aria-hidden="true" focusable="false"><use href="#${iconId}"></use></svg>`
    : "";
  return `<span class="chip${secondary ? " secondary" : ""}">${ico}${t}</span>`;
};

const fmtDateView = (s)=> s ? new Date(s+"T00:00:00").toLocaleDateString(undefined,{month:"short",day:"numeric",year:"numeric"}) : "—";

  const INTEL_ICON = {
  "Solitude": "c-features",          // ✅ flipped
  "Photo Ops": "c-morale",           // ✅ flipped
  "Physical Challenge": "c-elevation",
  "Navigation Difficulty": "c-gps",
  "Scenic Reward": "c-trail"         // ✅ flag icon
};


/* ===== Parse SCOUT text (options only) ===== */
function parseScoutOptions(txt){
  const sections=[]; const re=/OPTION\s+(\d+)\s+–\s+([^\n]+)\s*\n([\s\S]*?)(?=\n---|\nFINAL RECOMMENDATION|$)/g; let m;
  while((m=re.exec(txt))!==null){
    const [,idx,title,body]=m;
    const grab=(label)=>{ const r=new RegExp(label+":\\s*([\\s\\S]*?)(?:\\n\\n|\\r\\n\\r\\n|\\n(?=[A-Z][A-Za-z ]+:)|$)");
      const mm=body.match(r); return mm?mm[1].trim():""; };
    const kv=(label)=>grab(label).split("\n")[0].trim();
    const region=kv("Region");
    const dist=kv("Distance and elevation gain/loss");
    const duration=kv("Suggested Duration");
    const objective=kv("Primary Objective");
    const terrain=kv("Terrain");
    const season=kv("Ideal Season");
    const hazards=kv("Known Hazards");
    const culmin=kv("Culminating Objective");
    const objClass=kv("Objective Class");
    const advantage=kv("Strategic Advantage");
    const routeType=kv("Route Type");
    const overview=grab("Route Overview");
    const logistics=grab("Logistics Snapshot");
    const intelBlock=grab("Intel Score \\(1–10\\)");

    let miles=null, gain_ft=null, loss_ft=null;
    const mmiles=dist.match(/([\d.,]+)\s*miles?/i); if(mmiles) miles=mmiles[1];
    const mgain=dist.match(/\+([\d.,]+)\s*ft/i);    const mloss=dist.match(/-([\d.,]+)\s*ft/i);
    if(mgain) gain_ft=mgain[1].replace(/,/g,""); if(mloss) loss_ft=mloss[1].replace(/,/g,"");

    const intel={}; if(intelBlock){
      intelBlock.split("\n").forEach(line=>{
        const t=line.match(/•?\s*([A-Za-z ]+):\s*(\d+)/); if(t) intel[t[1].trim()]=Number(t[2]);
      });
    }

    let blueprint_url=""; const linkMatch=body.match(/\[Blueprint[^\]]*\]\((https?:\/\/[^\s)]+)\)/i);
    if(linkMatch) blueprint_url=linkMatch[1];

    sections.push({ index:Number(idx), title:title.trim(), region, overview, miles, gain_ft, loss_ft, duration,
      objective, terrain, season, hazards, culminating_objective:culmin, objective_class:objClass,
      strategic_advantage:advantage, route_type:routeType, logistics, intel, blueprint_url });
  }
  return sections;
}

/* ===== Build one option card body ===== */
function buildScoutCard(opt, index){
  const chips=[];
if (opt.duration) chips.push(chip(opt.duration, false, "i-calendar"));         // DAYS
if (opt.miles)    chips.push(chip(`${opt.miles} miles`, false, "c-distance")); // MILES

// Elevation stays optional (still nice)
if (opt.gain_ft || opt.loss_ft) {
  const up = opt.gain_ft ? Number(opt.gain_ft).toLocaleString() : "0";
  const dn = opt.loss_ft ? Number(opt.loss_ft).toLocaleString() : "0";
  chips.push(chip(`+${up} ft / -${dn} ft`, true, "c-elevation"));
}

// TERRAIN
if (opt.terrain) chips.push(chip(opt.terrain, true, "c-terrain"));


  let logisticsHTML=""; if(opt.logistics){
    const lines = opt.logistics.replace(/\r/g,"").split("\n").map(s=>s.replace(/^[•\-\u2022]\s*/,"").trim()).filter(Boolean);
    if(lines.length){ logisticsHTML = `<ul style="margin:6px 0 0 18px; padding:0; line-height:1.5">${lines.map(li=>`<li>${li}</li>`).join("")}</ul>`; }
  }

const intelHTML = Object.keys(opt.intel || {}).length
  ? `<div class="chips" style="margin-top:8px">
      ${Object.entries(opt.intel).map(([k,v]) => {
        const icon = INTEL_ICON[k] || "c-decision"; // fallback
        return chip(`${k}: ${v}`, true, icon);
      }).join(" ")}
     </div>`
  : "";

  return `
    <div>
      <h3 style="margin:0 0 4px">${opt.title || `Option ${index+1}`}</h3>
      ${opt.region ? `<p class="subhead">${opt.region}</p>` : ""}
      ${chips.length ? `<div class="chips" style="margin:6px 0 10px">${chips.join(" ")}</div>` : ""}
      ${opt.overview ? `<p class="previewP" style="margin-top:8px">${opt.overview}</p>` : ""}
      <div class="row"><div class="k">Primary Objective:</div><div>${opt.objective || "—"}</div></div>
      <div class="row"><div class="k">Ideal Season:</div><div>${opt.season || "—"}</div></div>
      <div class="row"><div class="k">Known Hazards:</div><div>${opt.hazards || "—"}</div></div>
      <div class="row"><div class="k">Culminating Objective:</div><div>${opt.culminating_objective || "—"}</div></div>
      <div class="row"><div class="k">Objective Class:</div><div>${opt.objective_class || "—"}</div></div>
      <div class="row"><div class="k">Strategic Advantage:</div><div>${opt.strategic_advantage || "—"}</div></div>
      <div class="row"><div class="k">Route Type:</div><div>${opt.route_type || "—"}</div></div>
      ${logisticsHTML ? `<div class="row" style="border-top:1px dashed var(--div-soft); padding-top:10px"><div class="k">Logistics Snapshot:</div><div>${logisticsHTML}</div></div>` : ""}
      ${intelHTML}
    </div>
  `;
}
// === CHECKOUT (Scout ➜ Blueprint) ===
const CHECKOUT_ENDPOINT =
  "https://rtpfkfhvlkuagwqdsnfj.supabase.co/functions/v1/create-checkout-session";

// 👉 Put your Stripe Price ID here (from the Scout → Blueprint product)
const PRICE_UPGRADE = "price_1S4jmKKyANuReHHWTf5jC6CB"; // <-- replace with your real Price ID

/* ===== CTA wiring ===== */
function ensureCTA(){
  const card=$id('optCard'); if(!card) return;
  let wrap=$id('blueprintCta');
  if(!wrap){
    wrap=document.createElement('div'); wrap.id='blueprintCta'; wrap.className='cta';
    wrap.innerHTML=`<button class="btn-cta" id="btnBlueprint" type="button" disabled>Blueprint this route →</button><small id="ctaHint">Select an option above</small>`;
    card.appendChild(wrap);
  }
}

function saveScoutContext(optIndex){
  try {
    const ctx = { options: SCOUT.options || [], chosenIndex: optIndex, createdAt: Date.now() };
    localStorage.setItem("ei_scout_v1", JSON.stringify(ctx));
  } catch {}
}

async function startCheckout(opt){
  saveScoutContext(ACTIVE);

  const btn = document.getElementById("btnBlueprint");
  if (btn) { btn.disabled = true; btn.textContent = "Opening checkout…"; }

  try {
    const payload = {
      price_id: PRICE_UPGRADE, // ✅ REQUIRED by your edge function
      customer_email: document.getElementById("fEmail")?.value || "",
      metadata: {
  source: "scout_preview",
  intake_id: (window.EI_INTAKE_ID || localStorage.getItem("EI_INTAKE_ID") || ""),
  option_index: String(ACTIVE + 1),
  option_title: String(opt.title || `Option ${ACTIVE + 1}`),
  option_uid: String(opt.option_uid || ""),
  user_name:  document.getElementById("fName")?.value?.trim() || "",
  user_email: document.getElementById("fEmail")?.value?.trim() || "",
  trip_date: document.getElementById("tripDate")?.value || "",
  primary_objective: document.getElementById("fObjective")?.value || "",
  preferred_terrain: document.getElementById("fTerrain")?.value || "",
  ideal_trip_length: document.getElementById("fLength")?.value || "",
  based_in: document.getElementById("fBasedIn")?.value || "",
  destination_idea: document.getElementById("fIdea")?.value || "",
  notes: (document.getElementById("fAdditional")?.value || "").slice(0,480),
  trip_window: document.getElementById("tripDate")?.value || "",
}
    };

    const res = await fetch(CHECKOUT_ENDPOINT, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const data = await res.json().catch(() => ({}));
    if (!res.ok || !data?.url) throw new Error("No checkout URL");

    window.location.href = data.url;
  } catch (err) {
    console.error(err);
    alert("Checkout unavailable. Please try again.");
  } finally {
    if (btn) {
      btn.disabled = false;
      btn.textContent = `Blueprint this route →`;
    }
  }
}

function updateCTA_forScout(opt){
  const wrap=$id('blueprintCta'), btn=$id('btnBlueprint'), hint=$id('ctaHint');
  if(!wrap||!btn||!hint) return;
  if(!opt){ wrap.style.display='none'; return; }

  btn.disabled=false;
  btn.textContent=`Blueprint “${opt.title || `Option ${ACTIVE+1}`}” →`;
  hint.textContent='Purchase to unlock full Blueprint';
  wrap.style.display='flex';
  btn.onclick=()=> startCheckout(opt);
}

/* ===== State + tabs ===== */
let SCOUT = (window.SCOUT = { options: [] });
let ACTIVE = (window.ACTIVE = 0);

function setActive(idx){
  ACTIVE=idx;
  window.ACTIVE = ACTIVE;
  const tabs=$id("optTabs"), card=$id("optCard"); if(!tabs||!card) return;
  tabs.querySelectorAll("button").forEach((b,i)=>b.setAttribute("aria-selected", i===idx ? "true" : "false"));
  const opt=SCOUT.options[idx];
  card.innerHTML=buildScoutCard(opt, idx);
  ensureCTA(); updateCTA_forScout(opt); updateLeftBlueprintCTA();
}
  
function renderTabs(){
  const tabs=$id("optTabs"); if(!tabs) return;
  tabs.innerHTML=(SCOUT.options||[]).map((o,i)=>{
    const label=o.label||o.title||o.route||o.tagline?.marketing||"";
    const name=label ? `OPTION ${i+1} — ${label}` : `OPTION ${i+1}`;
    return `<li><button type="button" class="ei-tab" role="tab" aria-selected="${i===ACTIVE?'true':'false'}" data-idx="${i}">${name}</button></li>`;
  }).join("");
  tabs.onclick = (e) => {
  const b = e.target.closest("button[data-idx]");
  if (!b) return;

  // ✅ hard stop any accidental link navigation
  e.preventDefault();
  e.stopPropagation();
  e.stopImmediatePropagation();

  // ✅ also force-close nav if it was left open
const navRoot = document.querySelector("[data-ei-nav]");
if (navRoot?.classList.contains("is-open")) {
  navRoot.classList.remove("is-open");
  document.body.classList.remove("ei-nav-lock");
  const navBtn = navRoot.querySelector("[data-ei-nav-toggle]");
  navBtn?.setAttribute("aria-expanded", "false");
  navBtn?.setAttribute("aria-label", "Open menu");
}

  const idx = Number(b.dataset.idx);
  if (Number.isInteger(idx)) setActive(idx);
};
}

/* ===== Sample data (dev) ===== */
document.getElementById("loadSample")?.addEventListener("click", ()=>{
  SCOUT.options = [
    { index:1, title:"Mount Bierstadt Summit", region:"Front Range, Colorado", overview:"Classic CO 14er with a well-defined path to the summit.",
      miles:"7", gain_ft:"2850", loss_ft:"2850", duration:"1–2 days", objective:"Peak Summit / High Alpine Trekking",
      terrain:"Alpine meadows and rocky switchbacks", season:"mid-July–Sept", hazards:"Afternoon thunderstorms, altitude sickness",
      culminating_objective:"Mount Bierstadt, 14,065 ft", objective_class:"Class 1", strategic_advantage:"Straightforward ascent with big alpine views.",
      route_type:"Out-and-Back", logistics:"- Permit: No\n- Trailhead Access: Easy\n- Water: Requires planning\n- Campsite: Limited\n- Exit Strategy: Commit to full route",
      intel:{Solitude:5,"Photo Ops":8,"Physical Challenge":6,"Navigation Difficulty":3,"Scenic Reward":9},
      blueprint_url:"https://www.expeditionintel.com/upgrade?source=scout&option=1" },
    { index:2, title:"Mount Elbert Summit", region:"Sawatch Range, Colorado", overview:"Colorado’s highest peak; steep final push; massive vistas.",
      miles:"9", gain_ft:"4700", loss_ft:"4700", duration:"1–2 days", objective:"Peak Summit / High Alpine Trekking",
      terrain:"Forested trails and alpine ridges", season:"mid-July–Sept", hazards:"Weather changes, altitude effects",
      culminating_objective:"Mount Elbert, 14,440 ft", objective_class:"Class 1", strategic_advantage:"Prestige of CO high point with stunning views.",
      route_type:"Out-and-Back", logistics:"- Permit: No\n- Trailhead Access: Easy\n- Water: Sparse\n- Campsite: Abundant dispersed\n- Exit Strategy: Commit to full route",
      intel:{Solitude:4,"Photo Ops":9,"Physical Challenge":8,"Navigation Difficulty":3,"Scenic Reward":10},
      blueprint_url:"https://www.expeditionintel.com/upgrade?source=scout&option=2" },
    { index:3, title:"Quandary Peak Summit", region:"Tenmile Range, Colorado", overview:"Popular but rewarding summit with big Breck views.",
      miles:"6.75", gain_ft:"3450", loss_ft:"3450", duration:"1–2 days", objective:"Peak Summit / High Alpine Trekking",
      terrain:"Forested slopes and rocky ridges", season:"mid-July–Sept", hazards:"Weather changes, altitude effects",
      culminating_objective:"Quandary Peak, 14,265 ft", objective_class:"Class 1", strategic_advantage:"Straightforward climb; quick summit adventure.",
      route_type:"Out-and-Back", logistics:"- Permit: No\n- Trailhead Access: Easy\n- Water: Plan to carry\n- Campsite: Limited\n- Exit Strategy: Commit to full route",
      intel:{Solitude:4,"Photo Ops":8,"Physical Challenge":6,"Navigation Difficulty":2,"Scenic Reward":9},
      blueprint_url:"https://www.expeditionintel.com/upgrade?source=scout&option=3" }
  ];
  ACTIVE=0; renderTabs(); setActive(0);
});

/* ===== Submit to Edge ===== */
const ENDPOINT = "https://rtpfkfhvlkuagwqdsnfj.supabase.co/functions/v1/shadow-scout-recon-send";

// Make sure intake ID persists between form submit and checkout
window.EI_INTAKE_ID = localStorage.getItem("ei_intake_id") || "";
  
// === HERO IMAGE ENDPOINT ===
const HERO_ENDPOINT = "https://rtpfkfhvlkuagwqdsnfj.supabase.co/functions/v1/hero-image";
// Cancel in-flight lookups when user types fast
let heroAbort;
async function fetchHero({ place, region, orientation = "landscape" }) {
  if (heroAbort) heroAbort.abort();
  heroAbort = new AbortController();

  const q = [place, region].filter(Boolean).join(" ").trim();
  if (!q) return null;

  const u = new URL(HERO_ENDPOINT);
  u.searchParams.set("source", "auto");      // NPS first, then Unsplash
  u.searchParams.set("q", q);
  u.searchParams.set("orientation", orientation);
  u.searchParams.set("max", "1");

  const res = await fetch(u.toString(), { signal: heroAbort.signal });
  if (!res.ok) return null;
  const json = await res.json();             // { count, data: [ {src, credit, link, ...} ] }
  return (json.data && json.data[0]) || null;
}
/* ===== Rich loader: step progression (visual only) ===== */
const SCOUT_STEPS = [
  "Locking in your objective and trip window…",
  "Scouting terrain that matches your experience level…",
  "Checking season, access, and permit pressure…",
  "Scoring routes for risk, logistics, and bailout options…",
  "Formatting 3 route options for your inbox and preview…"
];

let scoutStepIndex = 0;
let scoutStepTimer = null;

function startScoutProgress() {
  const label = document.getElementById("scoutStepLabel");
  if (!label) return;

  scoutStepIndex = 0;
  label.textContent = SCOUT_STEPS[0];

  // Rotate every ~2.2s while the recon runs
  scoutStepTimer = setInterval(() => {
    scoutStepIndex = (scoutStepIndex + 1) % SCOUT_STEPS.length;
    label.textContent = SCOUT_STEPS[scoutStepIndex];
  }, 2200);
}

function stopScoutProgress() {
  if (scoutStepTimer) {
    clearInterval(scoutStepTimer);
    scoutStepTimer = null;
  }
}
  $id("scoutForm")?.addEventListener("submit", async (e)=>{
  e.preventDefault();
  const f=e.currentTarget;
  const get=(n)=> (f.elements.namedItem(n)?.value || "").trim();

  // combine destination
  const pref=(f.querySelector("#fDestination")?.value || "").trim();
  const idea=get("destination_idea");
  const destCombined = pref ? (idea ? `${pref}: ${idea}` : pref) : idea;
  const dateISO = get("tripDate");
  const season  = seasonFromISODate(dateISO);

// normalize en-dash to hyphen for enums like 1-2, 3-4, 5-6, 7+
const normalizeDash = s => (s || "").replace(/[–—]/g, "-");

// --- final payload (camelCase to match Edge) ---
const payload = {
  name: get("name"),
  email: get("email"),
  basedIn: get("based_in"),
  experienceLevel: get("experience_level"),
  primaryObjective: get("primary_objective"),
  idealTripLength: get("ideal_trip_length"),
  preferredTerrain: get("preferred_terrain"),
  destinationIdea: destCombined,     // optional; Edge doesn't require it
  additional: get("additional"),
  tripWindow: season                 // <-- was trip_window
};

  const required = [
  "name",
  "email",
  "basedIn",
  "experienceLevel",
  "primaryObjective",
  "idealTripLength",
  "preferredTerrain"
];
  const miss=required.filter(k=>!payload[k]); if(miss.length){ alert("Please complete:\n• "+miss.join("\n• ")); return; }

// ---- RESET UI (clears old options while new scout runs) ----
SCOUT.options = [];
ACTIVE = 0;
window.ACTIVE = 0;

setBlueprintMode("new");           // default mode while generating
updateLeftBlueprintCTA();          // hides toggle + sets button label

const tabs = $id("optTabs");
if (tabs) tabs.innerHTML = "";              // ✅ removes the leftover pills

const ctaWrap = $id("blueprintCta");
if (ctaWrap) ctaWrap.style.display = "none"; // ✅ hide right-side blueprint CTA during run

// Disable option blueprint button (right card) if it exists
const optBtn = $id("btnBlueprint");
if (optBtn) { optBtn.disabled = true; optBtn.textContent = "Blueprint this route →"; }

// Disable the left “Advance…” button during scout generation
const buyBtn = $id("btnBuyBlueprint");
if (buyBtn) { buyBtn.disabled = true; buyBtn.dataset.mode = "loading"; }

// ---- Disable Generate button + show loader card ----
const btn = $id("btnGenerateScout") || $id("btnGenerate");
if (btn) { btn.disabled = true; btn.textContent = "Generating…"; }

const card = $id("optCard");
if (card) {
  card.innerHTML = `
    <div id="scoutLoading">
      <div class="spin"></div>

      <div style="width:100%">
        <div class="h">Generating your Scout Recon</div>
        <div class="p" id="scoutStepLabel">Locking in your objective…</div>

        <div class="bar"><span></span></div>

        <div class="chips chips--steps" style="margin-top:12px">
          <span class="chip secondary">
            <svg aria-hidden="true" focusable="false"><use href="#c-decision"></use></svg>
            Step 1: Complete Form
          </span>
          <span class="chip secondary">
            <svg aria-hidden="true" focusable="false"><use href="#c-features"></use></svg>
            Step 2: Discover Scout
          </span>
          <span class="chip secondary">
            <svg aria-hidden="true" focusable="false"><use href="#c-trail"></use></svg>
            Step 3: Review Options
          </span>
        </div>

        <div class="p" style="margin-top:10px;font-size:12px;opacity:.7;">
          Typical runtime: under a minute. We save your intake, generate 3 options, wire upgrade links, and prep the preview + email.
        </div>
      </div>
    </div>
  `;
}
startScoutProgress();

  try {
    const res = await fetch(ENDPOINT, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(payload),
  keepalive: true
});

// Try to parse JSON (new mode: includes intake_id + text)
let data = {};
try {
  data = await res.json();
} catch {
  // Fallback if old text-only response
  const txt = await res.text();
  data = { text: txt };
}

// ✅ Store intake_id for this preview session (used by checkout)
if (data.intake_id) {
  try {
    window.EI_INTAKE_ID = data.intake_id;
    localStorage.setItem("EI_INTAKE_ID", data.intake_id);
    console.debug("[preview] EI_INTAKE_ID set ->", data.intake_id);
  } catch (_) {}
}

const text = data.text || "";

    if (!res.ok || !text) {
      card && (card.innerHTML = `<div class="empty">Something went wrong. Please try again.</div>`);
      return;
    }

    const opts = parseScoutOptions(text);
if (!opts.length) {
  console.warn("Could not parse Scout text:", text);
  card && (card.innerHTML = `<div class="empty">Scout was sent via email. (Preview parsing unavailable)</div>`);
  return;
}

/* --- D. Ensure each parsed option carries option_uid (fallback) --- */
(function attachUidFallback() {
  function extractUidFromUrl(href) {
    try {
      const u = new URL(href, location.origin);
      const b64 = u.searchParams.get("b64");
      if (b64) {
        const decoded = JSON.parse(decodeURIComponent(atob(b64)));
        return String(decoded?.metadata?.option_uid || "");
      }
      return String(u.searchParams.get("option_uid") || "");
    } catch {
      return "";
    }
  }
  opts.forEach(o => {
    const href = o?.cta?.url || o?.href || "";
    if (!o.option_uid) o.option_uid = extractUidFromUrl(href);
  });
})();

/* --- Prefer canonical from your schema: scout_latest_payload --- */
try {
  const iid = window.EI_INTAKE_ID || "";
  if (iid) {
    const r = await fetch(
      `${SUPABASE_URL}/rest/v1/scout_latest_payload?select=options&intake_id=eq.${encodeURIComponent(iid)}&limit=1`,
      { headers: { apikey: SUPABASE_ANON_KEY, Authorization: `Bearer ${SUPABASE_ANON_KEY}` } }
    );
    const arr = await r.json().catch(() => []);
    const canonical = Array.isArray(arr) && arr[0]?.options ? arr[0].options : null;

    if (canonical && canonical.length) {
      // map canonical -> your UI shape (index/title/region/option_uid)
      const withUids = canonical.map((o, i) => ({
        index:  Number(o.option_index ?? (i + 1)),
        title:  String(o.title ?? `Option ${i + 1}`),
        region: String(o.region ?? ""),
        option_uid: String(o.option_uid ?? "")
      })).sort((a, b) => a.index - b.index);

      SCOUT.options = withUids;
    } else {
      SCOUT.options = opts.sort((a, b) => a.index - b.index);
    }
  } else {
    SCOUT.options = opts.sort((a, b) => a.index - b.index);
  }
} catch {
  SCOUT.options = opts.sort((a, b) => a.index - b.index);
}

// drop any stale hrefs from older runs (safety)
SCOUT.options.forEach(o => { o.blueprint_url = null; });

ACTIVE = 0;
renderTabs();
setActive(0);
const buyBtn = $id("btnBuyBlueprint");
if (buyBtn) buyBtn.disabled = false;

setBlueprintMode("upgrade");  // default after Scout exists
updateLeftBlueprintCTA();     // shows toggle + sets button label to selected option


  } catch (err) {
    console.error(err);
    card && (card.innerHTML = `<div class="empty">Network error. Please try again.</div>`);
  } finally {
    if (btn) {
      btn.disabled = false;
      btn.textContent = "Discover Free Scout";
    }
    stopScoutProgress();
    
const buyBtn2 = $id("btnBuyBlueprint");
if (buyBtn2) buyBtn2.disabled = false;

// Only reset to "new" if no Scout options exist (i.e., failed run)
if (!(window.SCOUT?.options && window.SCOUT.options.length)) {
  setBlueprintMode("new");
}

// Refresh the button label + toggle visibility
updateLeftBlueprintCTA();
  }

}); // <-- closes addEventListener
/* =========================
   Live preview wiring
   ========================= */
function seasonFromISODate(iso){
  if(!iso) return "";
  const m = Number(iso.slice(5,7));
  if([12,1,2].includes(m)) return "Winter";
  if([3,4,5].includes(m))  return "Spring";
  if([6,7,8].includes(m))  return "Summer";
  return "Fall";
}

(function liveMirror(){
  const form = document.getElementById("scoutForm");
  if (!form) return;

  const OUT = {
    title:    document.getElementById("pv_title"),
    category: document.getElementById("pv_category"),
    season:   document.getElementById("pv_season"),
    location: document.getElementById("pv_location"),
    date:     document.getElementById("pv_date"),
    hero:     document.getElementById("pv_hero")
  };
  
  const heroLoader = document.getElementById("hero_loading");
  const showHeroLoading = (on) => {
  if (!heroLoader) return;
  heroLoader.hidden = !on;
};

    // Debounced hero updater
let heroTimer = null;

async function updateHeroIfNeeded(placeText) {
  clearTimeout(heroTimer);

  heroTimer = setTimeout(async () => {
    const heroImg = OUT.hero;
    if (!heroImg) return;

    if (!placeText || placeText.trim().length < 3) {
  // show a static default so users see something right away
  heroImg.src = "/assets/recon-placeholder.jpg"; 
  const credit = document.getElementById("pv_credit");
  if (credit) { 
    credit.textContent = ""; 
    credit.style.display = "none"; 
  }
  showHeroLoading(false);
  return;
}

    // show loading overlay
    showHeroLoading(true);
    heroImg.style.opacity = "0.6";

    try {
      // Try to split "Place, Region" into parts so NPS/Unsplash match better
      const [placePart, regionPart] = placeText.split(/\s*[,|-]\s*/);
      const place = (placePart || "").trim();
      const region = (regionPart || "").trim();

      const hit = await fetchHero({
        place,
        region,
        orientation: "landscape"
      });

      if (hit && hit.src) {
        heroImg.src = hit.src;
        heroImg.alt = hit.alt || placeText;

        const credit = document.getElementById("pv_credit");
        if (credit) {
          credit.innerHTML = hit.credit ? hit.credit : "";
          credit.style.display = hit.credit ? "block" : "none";
        }
      }
    } catch (err) {
      console.error("Hero fetch error:", err);
    } finally {
      heroImg.style.opacity = "1";
      showHeroLoading(false); // hide overlay when done
    }
  }, 250);
}

  const getMeta = (k)=> form.querySelector(`[data-ei-meta="${k}"]`)?.value?.trim() || "";

  function paint(){
  const dateISO = getMeta("date");
  const season  = seasonFromISODate(dateISO) || "—";

  OUT.title    && (OUT.title.textContent    = getMeta("title")    || "Name Your Expedition");
  OUT.category && (OUT.category.textContent = getMeta("category") || "—");
  OUT.season   && (OUT.season.textContent   = season);
  OUT.location && (OUT.location.textContent = getMeta("location") || "—");
  OUT.date     && (OUT.date.textContent     = dateISO ? fmtDateView(dateISO) : "—");

  const loc = getMeta("location");
  const ttl = getMeta("title");
  const heroQuery = loc || ttl;           // fall back to the title
  updateHeroIfNeeded(heroQuery);
}

  form.addEventListener("input", paint);
  form.addEventListener("change", paint);
  paint();
})();
/* ===== Initial ===== */
(function initPreview(){
  ensureCTA();
})();
  /* =========================================================
   MARK REQUIRED / OPTIONAL LABELS
   ========================================================= */
(function markRequiredOptional(){
  const form = document.getElementById('scoutForm');
  if (!form) return;
  form.querySelectorAll('label').forEach(label=>{
    if (label.hasAttribute('data-no-auto')) return; // skip if manually controlled
    const ctrl = label.nextElementSibling;
    if (!ctrl) return;
    label.classList.toggle('is-required',  ctrl.matches('[required]'));
    label.classList.toggle('is-optional', !ctrl.matches('[required]'));
  });
})();
</script>
<!-- PURCHASE EXPEDITION BLUEPRINT HANDLER -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const $ = (sel) => document.querySelector(sel);
  const val = (sel) => {
    const el = $(sel);
    return el ? (el.value || "").trim() : "";
  };

  function getFormValues() {
    return {
      title: val('[name="trip_title"], #trip_title, [data-ei="trip_title"]'),
      trip_date: val('[name="trip_date"], #trip_date, [data-ei="trip_date"], #tripDate, [name="tripDate"]'),
      based_in: val('[name="city"], [name="based_in"], #based_in, [data-ei="based_in"]'),
      destination: val('[name="destination"], #destination, [data-ei="destination"]'),
      destination_idea: val('[name="destination_idea"], #destination_idea, [data-ei="destination_idea"]'),
      name: val('[name="name"], #name, [data-ei="name"]'),
      email: val('[name="email"], #email, [data-ei="email"]'),
      experience_level: val('[name="experience_level"], #experience_level, [data-ei="experience_level"]'),
      primary_objective: val('[name="primary_objective"], #primary_objective, [data-ei="primary_objective"]'),
      ideal_trip_length: val('[name="ideal_trip_length"], #ideal_trip_length, [data-ei="ideal_trip_length"]'),
      preferred_terrain: val('[name="preferred_terrain"], #preferred_terrain, [data-ei="preferred_terrain"]'),
      additional: val('[name="additional"], #additional, [data-ei="additional"]')
    };
  }

  async function buyBlueprintDirect() {
    console.log("✅ buyBlueprintDirect fired");

    // If a Scout exists, the left button should blueprint the currently-selected option
const hasScout = !!(window.SCOUT?.options && window.SCOUT.options.length);

if (hasScout && BLUEPRINT_MODE === "upgrade") {
  const opt = window.SCOUT.options[window.ACTIVE || 0];
  if (!opt) { alert("Select an option first."); return; }
  return startCheckout(opt); // Scout->Blueprint upgrade
}

// If mode is "new" (or no scout), continue into the direct Blueprint checkout flow below.

    // 1) Gate ALL orange-* fields (every control with [required])
    const form = document.getElementById("scoutForm");
    if (form) {
      const missing = [];

      form.querySelectorAll("[required]").forEach((el) => {
        const value = (el.value || "").trim();
        if (!value) {
          // Find matching label text for a human-readable name
          const label =
            (el.id && form.querySelector(`label[for="${el.id}"]`)) || null;
          const labelText = label
            ? label.textContent.trim()
            : (el.name || el.id || "This field");

          if (!missing.includes(labelText)) {
            missing.push(labelText);
          }
        }
      });

      if (missing.length) {
        alert(
          "To advance straight to an Expedition Blueprint, please complete:\n\n" +
          missing.map((t) => "• " + t).join("\n")
        );
        return;
      }
    }

    // 2) Existing form reads
    const f = getFormValues();

    // Extra safety: email + destination idea
    if (!f.email) {
      alert("Please add your email so we can send your Blueprint.");
      return;
    }
    if (!f.destination_idea) {
      alert(
        "Add a Destination idea so we can build your Blueprint correctly, or choose “I want you to choose for me.”"
      );
      return;
    }

    const BLUEPRINT_PRICE_ID = "price_1SRw3ZKyANuReHHWei4HLs5K";

    const payload = {
      price_id: BLUEPRINT_PRICE_ID,
      customer_email: f.email,
      success_url:
        "https://www.expeditionintel.com/success?session_id={CHECKOUT_SESSION_ID}",
      cancel_url: "https://www.expeditionintel.com/checkout/canceled",
      metadata: {
        source: "blueprint_direct",
        user_name: f.name,
        user_email: f.email,
        title: f.title,
        trip_date: f.trip_date,
        based_in: f.based_in,
        destination: f.destination,
        destination_idea: f.destination_idea,
        experience_level: f.experience_level,
        primary_objective: f.primary_objective,
        ideal_trip_length: f.ideal_trip_length,
        preferred_terrain: f.preferred_terrain,
        notes: f.additional
      }
    };

    try {
      const res = await fetch(
        "https://rtpfkfhvlkuagwqdsnfj.supabase.co/functions/v1/create-checkout-session",
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        }
      );

      const j = await res.json();
      console.log("Stripe response:", j);

      if (!res.ok || !j.url) {
        console.error("❌ Checkout error:", j);
        alert("Checkout error. Try again.");
        return;
      }

      window.location.href = j.url;
    } catch (e) {
      console.error("❌ Network or fetch error:", e);
      alert("Network error. Try again.");
    }
  }

  const btn = document.getElementById("btnBuyBlueprint");
  if (btn) {
    btn.addEventListener("click", buyBlueprintDirect);
    console.log("⚙️ Blueprint listener attached to #btnBuyBlueprint");
  } else {
    console.error("❌ Button not found: #btnBuyBlueprint");
  }
});
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(location.search);
  const sessionId = params.get("session_id") || "";
  if (!sessionId) return;

  const JOB_STATUS = "https://rtpfkfhvlkuagwqdsnfj.supabase.co/functions/v1/job-status";

  const overlay = document.getElementById("eiBuildOverlay");
  const msg = document.getElementById("eiBuildMsg");
  const bar = document.getElementById("eiBuildBar");
  const done = document.getElementById("eiBuildDone");
  const err = document.getElementById("eiBuildErr");
  const openBtn = document.getElementById("eiOpenBlueprint");
  const slugEl = document.getElementById("eiBuildSlug");
  const stepLabel = document.getElementById("eiBuildStepLabel");
  const logEl = document.getElementById("eiBuildLog");

  if (!overlay || !msg || !bar || !done || !err || !openBtn || !slugEl) return;

  // ✅ force show overlay (works even if something set display:none)
  overlay.hidden = false;
  overlay.style.display = "flex";

  const LOG_LIMIT = 4;
  const seen = new Set();
  const logLines = [];

  function pushLog(line){
    if (!line) return;
    if (seen.has(line)) return;
    seen.add(line);
    logLines.push(line);
    while (logLines.length > LOG_LIMIT) logLines.shift();

    if (logEl){
      logEl.style.display = "block";
      logEl.innerHTML = logLines.map(t => `<div class="line">• ${t}</div>`).join("");
    }
  }

  function friendlyFromStatus(status){
    if (status === "queued") return { msg:"Queued — waiting for builder pickup…", step:"Queued…" };
    if (status === "running") return { msg:"Builder active. Executing…", step:"Building…" };
    return { msg:"Standing by…", step:"Initializing…" };
  }

  function friendlyMessage(raw, status){
    const s = String(raw || "").trim();
    if (!s) return friendlyFromStatus(status);

    // hard-strip function names + internal jargon
    const stripped = s
      .replace(/\bworker-[a-z0-9-]+\b/gi, "")
      .replace(/\bshadow[_ -]?jobs?\b/gi, "")
      .replace(/\s{2,}/g, " ")
      .trim();

        // Normalize drain's generic completion message
    if (/^done$/i.test(stripped)) {
      return { msg: "Blueprint ready.", step: "Complete" };
    }

    // map common phases → human
    const MAP = [
      { re:/enqueue|enqueued|queued/i, msg:"Queued — waiting for builder pickup…", step:"Queued…" },
      { re:/starting|boot|init/i,       msg:"Builder online — starting assembly…", step:"Starting…" },
      { re:/gpt|generate|route/i,       msg:"Generating route intelligence…",      step:"Intel build…" },
      { re:/permit|rec\.?gov|access/i,  msg:"Checking permits and access windows…", step:"Permits…" },
      { re:/gpx|track|route file/i,     msg:"Building GPX route package…",         step:"GPX…" },
      { re:/map|google|waypoint/i,      msg:"Rendering maps and waypoints…",       step:"Maps…" },
      { re:/email|deliver|send/i,       msg:"Packaging deliverables and sending email…", step:"Delivery…" },
      { re:/final|wrap|complete/i,      msg:"Final checks…",                       step:"Finalizing…" },
    ];

    for (const m of MAP){
      if (m.re.test(stripped)) return { msg:m.msg, step:m.step };
    }

    // fallback: show cleaned message, but never internal function ids
    return { msg: stripped || "Processing…", step: "Building…" };
  }


  overlay.hidden = false;
  overlay.style.display = "flex";

  let t = 0;
  let stopped = false;
  let timer = null;

  const HARD_TIMEOUT_MS = 30000;       // 30s fallback if queue is off / no job record
  const startedAt = Date.now();

  function stopPolling() {
    stopped = true;
    if (timer) clearTimeout(timer);
  }

  function fallbackNoQueue() {
    // Don’t "fail" — just stop and tell them what’s happening.
    bar.style.width = "100%";
    msg.textContent = "Payment confirmed. Your Blueprint is being prepared — check your email shortly.";
    done.style.display = "none";
    err.style.display = "none";
    stopPolling();
  }

  async function tick(){
    if (stopped) return;

    try {
      // progress animation while waiting
      t += 1;
      bar.style.width = Math.min(95, 18 + t * 3) + "%";

      const url = JOB_STATUS + "?session_id=" + encodeURIComponent(sessionId);
      const res = await fetch(url, { cache: "no-store" });

      // If job-status is temporarily down, keep trying until timeout
      if (!res.ok) throw new Error("status http " + res.status);

      const j = await res.json().catch(() => null);

      // If queue is off, job-status will likely return null forever.
      // Wait a bit, then show a friendly message and stop.
      if (!j) {
        if ((Date.now() - startedAt) > HARD_TIMEOUT_MS) {
          fallbackNoQueue();
          return;
        }
        msg.textContent = "Payment confirmed. Finalizing…";
        if (stepLabel) stepLabel.textContent = "Queued…";
        pushLog("Payment confirmed. Finalizing…");
        timer = setTimeout(tick, 1500);
        return;
      }

      const f = friendlyMessage(j.message, j.status);
      msg.textContent = f.msg;
      if (stepLabel) stepLabel.textContent = f.step;
      pushLog(f.msg);

      // Normalize result
      let R = j.result;
      if (typeof R === "string") {
        try { R = JSON.parse(R); } catch {}
      }

      if (j.status === "succeeded") {
        if (R && R.ok) {
          bar.style.width = "100%";
          done.style.display = "flex";
          overlay.querySelector(".ei-buildCard")?.classList.add("is-done");
          if (stepLabel) stepLabel.textContent = "Complete";

          const slug = R.slug || "";
          slugEl.textContent = slug ? ("Slug: " + slug) : "";

          openBtn.href = slug
            ? `https://trip.expeditionintel.com/trip/${slug}`
            : (R.json_url || "#");

          pushLog("Blueprint ready. Redirect unlocked.");

          stopPolling();
          return;
        }

        if (R && R.ok === false) {
          err.style.display = "block";
          msg.textContent = R.error || "Build failed.";
          stopPolling();
          return;
        }
      }

      if (j.status === "failed") {
        err.style.display = "block";
        msg.textContent = j.error_text || "Build failed.";
        stopPolling();
        return;
      }

      // Also stop after timeout even if we keep seeing queued/running (prevents infinite spinner)
      if ((Date.now() - startedAt) > HARD_TIMEOUT_MS * 4) { // 2 minutes
        msg.textContent = "Still working… you can close this tab. We’ll email you when it’s ready.";
        stopPolling();
        return;
      }

      timer = setTimeout(tick, 2000);
    } catch (e) {
      // transient errors; still honor timeout
      if ((Date.now() - startedAt) > HARD_TIMEOUT_MS) {
        fallbackNoQueue();
        return;
      }
      timer = setTimeout(tick, 2500);
    }
  }

  tick();
});
</script>

</body>
</html>
